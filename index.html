<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOUTH VALLEY Command Center</title>
    <!-- Chargement de Tailwind CSS pour le style -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* D√©finition de l'URL de l'image de fond */
        :root {
            --bg-image-url: url('https://res.cloudinary.com/dlmmylat6/image/upload/v1764908117/Design_sans_titre_1_lhtsct.png'); /* NOUVEAU FOND STYLIS√â (Fond g√©n√©ral) */
            --logo-overlay-url: url('https://res.cloudinary.com/dlmmylat6/image/upload/v1764909554/Sans_titre_Logo_r1rnq7.png'); /* NOUVEAU LOGO FLOTTANT */
            --color-primary: #10B981; /* Vert √âmeraude (Action/Hash&Zaza) */
            --color-secondary: #94A3B8; /* NOUVEAU: Gris Ardoise/Argent (Acc√®s/Snow) */
            --color-bg: #111827; /* Gris fonc√©/Noir */
            --color-text: #F9FAFB; /* Blanc */
        }
        body { 
            background-color: var(--color-bg); 
            font-family: 'Inter', sans-serif; 
            overflow-x: hidden; 
            /* APPLICATION DU FOND STYLIS√â */
            background-image: var(--bg-image-url);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            background-attachment: fixed; /* Reste fixe en scrollant */
        }
        /* Rendre l'application Semi-Transparente pour le Dark Mode */
        #appContainer {
            /* Garder une l√©g√®re transparence pour laisser l'image de fond visible */
            background-color: rgba(17, 24, 39, 0.9); 
            min-height: 100vh;
        }
        /* Style pour simuler l'int√©gration TMA (ajustement de la barre de navigation) */
        .bottom-nav, header { 
            background-color: rgba(31, 41, 55, 0.95); /* Navigation plus opaque */
        }
        .loading-screen {
            background-color: var(--color-bg);
            z-index: 100;
        }
        /* Styles pour la vid√©o de chargement */
        .video-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            opacity: 0.2; /* Rend le fond subtil */
        }
        .video-container video {
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .loading-content {
            z-index: 10; /* Assure que le texte est au-dessus de la vid√©o */
        }
        /* --- IC√îNES CORPORATE --- */
        .icon-menu::before { content: '‚ò∞'; font-size: 20px; line-height: 1; }
        .icon-cart::before { content: 'üì¶'; font-size: 20px; line-height: 1; }
        .icon-contact::before { content: 'üìû'; font-size: 20px; line-height: 1; }
        .icon-cart-header::before { content: 'üì¶'; }

        /* Styles pour les points qui sautillent (Loading Dots) */
        .dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--color-secondary);
            margin: 0 4px;
            animation: bounce 1.2s infinite ease-in-out;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body>

<!-- Chargement du SDK Telegram Mini App (Crucial pour l'interaction avec le bot) -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Audio pour le fond sonore (musique YouTube fournie) -->
<!-- SUPPRIM√â : L'audio causait des probl√®mes d'autoplay et de blocage. -->

<!-- √âcran de Chargement (Splash Screen) -->
<div id="loadingScreen" class="loading-screen fixed inset-0 flex flex-col items-center justify-center p-6 text-white transition-opacity duration-500">
    <!-- Vid√©o de transition en fond (Remplacer l'URL par votre vid√©o h√©berg√©e) -->
    <div class="video-container">
        <!-- URL Cloudinary pour la vid√©o de transition -->
        <video id="logoVideo" src="https://res.cloudinary.com/dlmmylat6/video/upload/v1764906501/Hailuo_Video_Please_try_to_make_the_image_m_449765216579096579_2_z65kit.mov" loop muted playsinline autoplay onerror="console.log('ERREUR: Vid√©o de logo non trouv√©e. Utiliser une URL de fichier .mp4 h√©berg√©e publiquement.')"></video>
    </div>

    <div class="loading-content relative flex flex-col items-center justify-center">
        <h1 class="text-4xl font-extrabold mt-4" style="color: var(--color-secondary);">SOUTH VALLEY üèúÔ∏è</h1>
        <p class="text-lg mt-1 font-semibold" style="color: var(--color-primary);">COMMAND CENTER</p>
        
        <!-- NOUVEAU: Points qui sautillent -->
        <div class="mt-8 flex items-center">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
        <p id="loadingText" class="text-xs mt-3 text-gray-400">V√©rification de la S√©curit√© en cours...</p>
    </div>
</div>


<!-- Contenu de la Mini App -->
<div id="appContainer" class="min-h-screen pb-16 hidden">

    <!-- Header (Titre) -->
    <header class="p-4 border-b border-gray-700 flex justify-between items-center sticky top-0 z-10" style="background-color: #1f2937;">
        <h1 class="text-xl font-bold" style="color: var(--color-primary);">SOUTH VALLEY üèïÔ∏è</h1>
        <button onclick="changeScreen('cart')" class="text-white hover:text-yellow-400 transition-colors">
            <span class="icon-cart-header text-2xl" role="img" aria-label="Panier"></span>
            <span id="cartCount" class="text-xs bg-red-600 rounded-full px-2 py-0.5 ml-1">0</span>
        </button>
    </header>

    <!-- Zone de Contenu (Affichage des √âcrans) -->
    <main id="mainContent" class="p-4">
        <!-- Les diff√©rents √©crans seront inject√©s ici -->
    </main>

    <!-- Navigation du Bas (Footer) -->
    <footer class="bottom-nav fixed bottom-0 left-0 right-0 h-16 flex justify-around items-center border-t border-gray-700 text-gray-400 text-xs z-20">
        <button onclick="changeScreen('menu')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-menu"></span> Menu
        </button>
        <button onclick="changeScreen('cart')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-cart"></span> Panier
        </button>
        <button onclick="changeScreen('contact')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-contact"></span> Contact
        </button>
    </footer>

    <!-- Modal pour la s√©lection des tiers de produits -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-30 p-4">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-sm shadow-2xl text-white">
            <h3 id="modalTitle" class="text-2xl font-extrabold mb-4" style="color: var(--color-secondary);"></h3>
            
            <!-- Conteneur Vid√©o -->
            <div id="videoContainerModal" class="mb-4 aspect-video bg-black rounded-lg overflow-hidden">
                <video id="productVideo" src="" controls muted class="w-full h-full object-cover"></video>
            </div>
            
            <p id="modalDesc" class="text-sm text-gray-400 mb-4"></p>
            
            <div id="tiersContainer" class="space-y-3 max-h-48 overflow-y-auto pr-2">
                <!-- Tiers inject√©s ici -->
            </div>

            <button onclick="closeModal()" class="mt-6 w-full py-3 font-bold rounded-xl bg-gray-700 hover:bg-gray-600 transition-colors">
                ANNULER / FERMER
            </button>
        </div>
    </div>
</div>

<script>
    // --- VARIABLES GLOBALES ---
    let currentScreen = 'menu';
    let cart = [];
    let securityCode = ''; // Code de s√©curit√© g√©n√©r√© pour la commande
    
    // D√©finition de la structure complexe des produits
    const productData = [
        { 
            id: 'MC', 
            name: 'MONT√â CRISTO', 
            category: 'Snow Valley', 
            icon: '‚òÉÔ∏è',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906305/IMG_1629_ntkjra.mp4', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/94A3B8/111827?text=S-MC',
            desc: 'Un arrivage givr√©e ü•∂ - venu tout droit de Bolivie üáßüá¥, ce Mont√© Cristo‚Äô fr√¥le la puret√© avec un taux de 0.98% ! üå¨Ô∏è',
            tiers: [
                { w: '1.G', p: 60 }, { w: '2.G', p: 120 }, { w: '3.G', p: 160 }, 
                { w: '5.G', p: 260 }, { w: '10.G', p: 400 }, { w: '50.G', p: 1500 }, 
                { w: '100.G', p: 2800 }
            ]
        },
        { 
            id: 'PK', 
            name: 'Pink Kush', 
            category: 'Hash & Zaza Valley', 
            icon: 'üß¨',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906290/06AECEF5-7C0A-493C-9588-99433B454A4E_2_1_hnlzee.mov', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/10B981/111827?text=H-PK',
            desc: 'Restock de cette Cali tout droit venu de nos amis Californiens üá∫üá∏, un taux atteignant les 34% de THC ! üå¨Ô∏è',
            tiers: [
                { w: '5.G', p: 60 }, { w: '10.G', p: 120 }, { w: '25.G', p: 220 }, 
                { w: '50.G', p: 360 }, { w: '100.G', p: 640 }, { w: '500.G', p: 2200 }
            ]
        },
        { 
            id: 'SM', 
            name: 'SIMPSONS MOUSSE 2K25', 
            category: 'Hash & Zaza Valley', 
            icon: 'üßΩ',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906298/IMG_1715_rtit70.mp4', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/10B981/111827?text=H-SM',
            desc: 'Nouvel arrivage Simpsons Mousse üßΩü•á la famille, Mousse de qualit√©, √† consommer sans mod√©ration !ü´ß',
            tiers: [
                { w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 170 }, 
                { w: '100.G', p: 350 }
            ]
        },
        { 
            id: 'XM', 
            name: 'XALE‚Äô MOUSSE', 
            category: 'Hash & Zaza Valley', 
            icon: 'üßΩ',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906313/IMG_1819_i4ipsf.mp4', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/10B981/111827?text=H-XM',
            desc: 'Nouvel arrivage mousseux üßº, Top jaune mousseux, s‚Äôeffrite facilement, fumette de qualit√© assur√©e ! ü§ù',
            tiers: [
                { w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 160 }, 
                { w: '100.G', p: 330 }
            ]
        }
    ];

    // Mappage des IDs/Cat√©gories pour la navigation
    const productsByCategory = {
        'Hash & Zaza Valley': productData.filter(p => p.category === 'Hash & Zaza Valley'),
        'Snow Valley': productData.filter(p => p.category === 'Snow Valley')
    };

    // --- LOGIQUE UTILITAIRE ---
    
    /** Met √† jour le compteur du panier dans le header */
    function updateCartDisplay() {
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById('cartCount').textContent = count;
    }

    /** G√©n√®re un code de s√©curit√© unique SV + 4 chiffres */
    function generateSecurityCode() {
        const randomDigits = Math.floor(1000 + Math.random() * 9000);
        return `SV${randomDigits}`;
    }

    // --- LOGIQUE D'AFFICHAGE ET DE NAVIGATION ---

    /** Affiche l'√©cran s√©lectionn√© */
    function changeScreen(screenName, category = null) {
        currentScreen = screenName;
        const content = document.getElementById('mainContent');
        content.innerHTML = '';
        window.scrollTo(0, 0); 

        // Style pour indiquer l'√©cran actif (non impl√©ment√© pour la d√©mo, mais bonne pratique)
        // document.querySelectorAll('.bottom-nav button').forEach(btn => {/*...*/});

        switch (screenName) {
            case 'menu':
                content.innerHTML = renderMenuScreen();
                break;
            case 'products':
                content.innerHTML = renderProductsScreen(category);
                break;
            case 'cart':
                content.innerHTML = renderCartScreen();
                break;
            case 'checkout':
                // G√©n√©rer le code de s√©curit√© AVANT l'affichage du checkout
                securityCode = generateSecurityCode();
                content.innerHTML = renderCheckoutScreen();
                break;
            case 'contact':
                content.innerHTML = renderContactScreen();
                break;
            case 'success':
                content.innerHTML = renderSuccessScreen();
                break;
            default:
                content.innerHTML = renderMenuScreen();
        }
    }

    /** √âcran principal avec les deux cat√©gories */
    function renderMenuScreen() {
        return `
            <div class="text-white">
                <!-- LOGO FLOTTANT (visible au-dessus du fond, positionn√©) -->
                <div id="logoOverlay" class="w-full mb-4"></div>
                
                <h2 class="text-xl font-bold text-white text-center mb-6">D√âCOUVREZ NOS MENUS !</h2>
                
                <!-- Hash & Zaza Valley (Utilisation des classes pour la taille) -->
                <div onclick="changeScreen('products', 'Hash & Zaza Valley')" class="mb-4 p-4 rounded-xl cursor-pointer transition-transform hover:scale-[1.02] shadow-lg h-32 flex flex-col justify-center" style="background-color: #1f2937; border-left: 5px solid var(--color-primary);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--color-primary);">Hash & Zaza Valley ü™¥üòÆ‚Äçüí®</h3>
                            <p class="text-sm text-gray-300">S√©lection de Qualit√© & Premium | Coffee Quality Certifi√© üèÖ</p>
                        </div>
                        <span class="text-3xl">üöÄ</span>
                    </div>
                </div>

                <!-- Snow Valley -->
                <div onclick="changeScreen('products', 'Snow Valley')" class="mb-4 p-4 rounded-xl cursor-pointer transition-transform hover:scale-[1.02] shadow-lg" style="background-color: #1f2937; border-left: 5px solid var(--color-secondary);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--color-secondary);">Snow Valley üèîÔ∏èüå¨Ô∏è</h3>
                            <p class="text-sm text-gray-300">Une exp√©rience givr√©e & unique | Puret√© Garantie ! üèÖ</p>
                        </div>
                        <span class="text-3xl">üíé</span>
                    </div>
                </div>
                
                <!-- Statut de S√©curit√© (D√©plac√© en bas du contenu) -->
                <h2 class="text-xl font-bold mt-8 mb-2 text-center" style="color: var(--color-secondary);">PLUG CERTIFI√â DEPUIS 2021 üîå</h2>
            </div>
        `;
    }

    /** √âcran des produits pour une cat√©gorie donn√©e */
    function renderProductsScreen(category) {
        const productList = productsByCategory[category] || [];
        const color = category === 'Hash & Zaza Valley' ? 'var(--color-primary)' : 'var(--color-secondary)';
        
        return `
            <button onclick="changeScreen('menu')" class="text-gray-400 hover:text-white mb-4 flex items-center">
                <span class="text-xl mr-2">‚¨ÖÔ∏è</span> Retour Menu
            </button>
            <h2 class="text-3xl font-extrabold mb-6 text-white" style="color: ${color};">${category} üèïÔ∏è</h2>
            
            <div class="grid grid-cols-1 gap-4">
                ${productList.map(p => {
                    const lowestTier = p.tiers[0];
                    return `
                        <div class="bg-gray-800 rounded-lg p-4 shadow-xl flex items-center space-x-4">
                            <!-- Miniature Vid√©o/Image -->
                            <div class="w-20 h-20 bg-black rounded-lg flex-shrink-0 relative overflow-hidden" onclick="openModal('${p.id}')">
                                <!-- La vid√©o joue en boucle comme miniature -->
                                <video src="${p.videoUrl}" loop muted playsinline autoplay class="w-full h-full object-cover"></video>
                                <span class="absolute inset-0 flex items-center justify-center text-4xl text-white opacity-0 hover:opacity-100 transition-opacity duration-300 cursor-pointer">üëÅÔ∏è</span>
                            </div>

                            <!-- Infos Produit -->
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-white mb-1">${p.icon} ${p.name}</h3>
                                <p class="text-sm text-gray-400 mb-2">${p.desc.length > 50 ? p.desc.substring(0, 50) + '...' : p.desc}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-extrabold" style="color: ${color};">${lowestTier.p}‚Ç¨ / ${lowestTier.w}</span>
                                    <button onclick="openModal('${p.id}')" class="bg-yellow-600 text-black px-3 py-1 rounded-full font-bold hover:bg-yellow-700 transition-colors flex items-center text-sm">
                                        Choisir ‚û°Ô∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    }

    /** Ouvre le modal de s√©lection des tiers de prix et charge la vid√©o */
    function openModal(productId) {
        const product = productData.find(p => p.id === productId);
        if (!product) return;

        document.getElementById('modalTitle').textContent = `${product.icon} ${product.name}`;
        document.getElementById('modalDesc').textContent = product.desc;

        // Afficher la vid√©o
        const videoElement = document.getElementById('productVideo');
        videoElement.src = product.videoUrl;
        
        // Charger la vid√©o mais ne pas d√©marrer la lecture (l'utilisateur doit cliquer)
        videoElement.load();

        const tiersHTML = product.tiers.map(tier => `
            <div class="flex justify-between items-center p-3 rounded-lg bg-gray-700">
                <span class="font-semibold">${tier.w}</span>
                <span class="font-extrabold" style="color: var(--color-primary);">${tier.p}‚Ç¨</span>
                <button 
                    onclick="addToCart('${product.id}_${tier.w}', '${product.name} (${tier.w})', ${tier.p})" 
                    class="bg-green-600 text-white px-3 py-1 text-sm rounded-full hover:bg-green-700 transition-colors"
                >
                    Ajouter üõí
                </button>
            </div>
        `).join('');

        document.getElementById('tiersContainer').innerHTML = tiersHTML;
        document.getElementById('productModal').classList.remove('hidden');
    }

    /** Ferme le modal */
    function closeModal() {
        // Stopper la vid√©o quand le modal est ferm√©
        const videoElement = document.getElementById('productVideo');
        videoElement.pause();
        document.getElementById('productModal').classList.add('hidden');
    }

    /** √âcran du Panier est le m√™me mais utilise la nouvelle structure */
    function renderCartScreen() {
        // ... (Pas de changement majeur, la structure existante fonctionne pour l'affichage)
        if (cart.length === 0) {
            return `
                <h2 class="text-3xl font-extrabold mb-6 text-white">üì¶ Mon Panier</h2>
                <div class="text-center p-10 bg-gray-800 rounded-lg text-gray-400">
                    <p class="text-xl">Votre panier est vide.</p>
                    <p class="mt-2">Ajoutez des produits de la s√©lection Prestige pour commander.</p>
                    <button onclick="changeScreen('menu')" class="mt-6 text-sm text-yellow-400 hover:text-yellow-500">
                        Explorer le Catalogue
                    </button>
                </div>
            `;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        return `
            <h2 class="text-3xl font-extrabold mb-6 text-white">üì¶ Mon Panier</h2>
            <div class="space-y-4">
                ${cart.map((item, index) => `
                    <div class="bg-gray-800 rounded-lg p-3 flex justify-between items-center text-white">
                        <div class="flex-1">
                            <p class="font-bold">${item.name}</p>
                            <p class="text-sm text-gray-400">${item.price}‚Ç¨ x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${index}, -1)" class="text-xl bg-gray-700 w-8 h-8 rounded-full">-</button>
                            <span class="w-4 text-center">${item.quantity}</span>
                            <button onclick="updateQuantity(${index}, 1)" class="text-xl bg-gray-700 w-8 h-8 rounded-full">+</button>
                            <button onclick="removeItem(${index})" class="text-red-500 hover:text-red-400 ml-3">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div class="mt-8 p-4 bg-gray-800 rounded-lg text-white">
                <p class="text-xl font-bold">TOTAL : <span class="float-right" style="color: var(--color-secondary);">${total}‚Ç¨</span></p>
            </div>

            <button onclick="changeScreen('checkout')" class="mt-6 w-full py-4 text-lg font-bold rounded-xl text-black transition-colors bg-yellow-400 hover:bg-yellow-500">
                PASSER AU CHECKOUT S√âCURIS√â üí≥
            </button>
        `;
    }


    /** √âcran de Paiement et Checkout */
    function renderCheckoutScreen() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Construction du r√©sum√© pour WhatsApp
        const orderDetails = cart.map(item => `   - ${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)`).join('\n');
        
        // D√©finir la fonction submitOrderWA comme callback pour le lien A
        const waLinkHref = "javascript:submitOrderWA(event);";

        return `
            <button onclick="changeScreen('cart')" class="text-gray-400 hover:text-white mb-4 flex items-center">
                <span class="text-xl mr-2">‚¨ÖÔ∏è</span> Retour Panier
            </button>
            <h2 class="text-3xl font-extrabold mb-6 text-white">üîí CHECKOUT S√âCURIS√â</h2>
            
            <div class="space-y-4 text-white">
                <p class="text-xl font-bold mb-4">TOTAL √Ä PAYER : <span style="color: var(--color-primary);">${total}‚Ç¨</span></p>

                <!-- V√©rification obligatoire -->
                <div class="p-3 rounded-lg text-sm bg-red-800 bg-opacity-30 border border-red-700">
                    <h3 class="font-bold text-red-400 mb-1">‚ö†Ô∏è V√âRIFICATION OBLIGATOIRE</h3>
                    <p class="text-xs text-gray-300">Pour toute <b>premi√®re commande</b>, la validation finale n√©cessite l'envoi d'une photo de votre **CNI & un Selfie** au Standard WhatsApp. Protocole de s√©curit√©. üõ°Ô∏è</p>
                </div>


                <!-- R√©sum√© de la Commande (Affichage) -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">R√âSUM√â DE L'ORDRE</h3>
                <div class="p-3 bg-gray-800 rounded-lg text-sm">
                    ${cart.map(item => `<p class="text-gray-300">${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)</p>`).join('')}
                </div>
                <p class="text-lg font-bold mt-3">TOTAL: <span class="float-right" style="color: var(--color-primary);">${total}‚Ç¨</span></p>

                <!-- Formulaire de Contact -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">1. Contact (Protocole)</h3>
                <input type="text" id="telegramPseudo" placeholder="Pseudo Telegram (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:border-yellow-400">
                <input type="text" id="contactNumber" placeholder="Num√©ro WhatsApp/Telegram (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:focus:border-yellow-400">
                <p class="text-xs text-gray-400 mt-1">Ceci garantit la discr√©tion et le suivi de votre ordre. üì≤</p>

                <!-- Formulaire de Livraison -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">2. Adresse de Livraison</h3>
                <input type="text" id="shippingName" placeholder="Nom Complet pour l'envoi (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:focus:border-yellow-400">
                <input type="text" id="shippingAddress" placeholder="Adresse compl√®te (Rue, Ville, Code Postal)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:border-yellow-400">
                
                <!-- Choix du Paiement -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">3. M√©thode de Paiement</h3>
                <div class="flex space-x-4">
                    <button id="paymentCash" onclick="setPayment('CASH')" class="flex-1 py-3 px-4 rounded-lg font-bold transition-all border-2 border-gray-700 text-gray-400 hover:border-yellow-400">
                        <span class="text-2xl">üíµ</span> CASH (Meet-up/Livraison)
                    </button>
                    <button id="paymentCrypto" onclick="setPayment('CRYPTO')" class="flex-1 py-3 px-4 rounded-lg font-bold transition-all border-2 border-gray-700 text-gray-400 hover:border-yellow-400">
                        <span class="text-2xl">‚Çø</span> CRYPTO (Postal)
                    </button>
                </div>
                <input type="hidden" id="paymentMethod" value="">
                
                <div id="policyContainer" class="mt-4 p-3 rounded-lg text-sm" style="background-color: #2D3748;">
                    <p class="font-bold text-white">Politique de Paiement :</p>
                    <p id="paymentPolicy" class="text-gray-300 mt-1 text-xs">Veuillez s√©lectionner une m√©thode pour afficher la politique de s√©curit√© associ√©e. üõ°Ô∏è</p>
                </div>


                <a id="waLinkCheckout" href="${waLinkHref}" target="_blank" onclick="submitOrderWA(event)" class="mt-8 w-full py-4 text-lg font-bold rounded-xl text-white transition-colors bg-green-600 hover:bg-green-700 flex items-center justify-center">
                    <span class="text-2xl mr-2">üü¢</span> VALIDER MA COMMANDE
                </a>
            </div>
        `;
    }
    
    /** √âcran Contact */
    function renderContactScreen() {
        // D√©finition de la couleur pour les titres secondaires des modalit√©s (Vert Emeraude, couleur primaire)
        const secondaryColor = 'var(--color-primary)'; 
        
        // Contenu des diff√©rentes sections du Bot de base
        const reseauxContent = `
            <h3 class="text-xl font-bold mt-2 mb-2" style="color: ${secondaryColor};">üåê Nos R√©seaux</h3>
            <p class="text-gray-300">Retrouvez-nous sur nos diff√©rentes plateformes pour suivre nos actualit√©s et rester connect√© √† South Valley ! üèúÔ∏è</p>
            <div class="mt-3 space-y-2">
                <a href="https://t.me/SouthValleyFarm" target="_blank" class="block py-2 rounded-lg font-bold bg-blue-600 text-white text-center">Canal Telegram Officiel üîµ</a>
                <a href="https://dympt.org/SouthV" target="_blank" class="block py-2 rounded-lg font-bold bg-gray-700 text-white text-center">POTATO ü•î</a>
                <a href="https://wa.me/33759840764" target="_blank" class="block py-2 rounded-lg font-bold bg-green-600 text-white text-center">What'sApp üü¢</a>
                <a href="https://linktr.ee/southvalleyfarm" target="_blank" class="mt-3 block py-2 rounded-lg font-bold bg-yellow-600 text-black text-center">üì≤ Tous nos r√©seaux</a>
            </div>
        `;

        const meetUpContent = `
            <h3 class="text-xl font-bold mt-6 mb-2" style="color: ${secondaryColor};">ü§ù M33T-UP South Valley</h3>
            <p class="text-gray-300">Nos meet-ups se d√©roulent dans le 92, √† une adresse discr√®te et sans vis-√†-vis pour garantir votre confort et votre s√©curit√©. üòá</p>
            <p class="text-gray-300">Desservie par la Ligne 13 - RER C & RER L ! ü•á</p>
            <p class="text-gray-300 mt-2">üï∞Ô∏è Horaires : 10:30 √† 2:00</p>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üìå Modalit√©s de commande :</h4>
            <ol class="list-decimal list-inside text-gray-400 text-sm space-y-1">
                <li>üÜî V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</li>
                <li>üõç Consulte le menu via notre bot & diff√©rents canaux.</li>
                <li>‚úçÔ∏è Envoie ta commande compl√®te.</li>
                <li>üí¨ On te communique l‚Äôadresse & l‚Äôitin√©raire.</li>
                <li>üö∂‚Äç‚ôÇÔ∏èTu passes r√©cup√©rer ta commande.</li>
            </ol>
        `;

        const livraisonContent = `
            <h3 class="text-xl font-bold mt-6 mb-2" style="color: ${secondaryColor};">üì¶ Livraisons South Valley ! üèúÔ∏è</h3>
            <p class="text-gray-300">Nous desservons toute l‚Äô√éle-de-France et certaines zones hors IDF.</p>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üì¶ Zones Couvertes :</h4>
            <ul class="list-disc list-inside text-gray-400 text-sm space-y-1">
                <li>√éle-de-France compl√®te üá´üá∑ (Min. : 60‚Ç¨ ü§ù)</li>
                <li>R√©gions limitrophes (28 / 60 / 45 / 02 / 89 / 27 / 10) (Min. : 200‚Ç¨ ü§ù)</li>
            </ul>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üìå Modalit√©s de commande :</h4>
            <ol class="list-decimal list-inside text-gray-400 text-sm space-y-1">
                <li>üÜî V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</li>
                <li>‚ö†Ô∏è Pr√©-commande lors des sessions de prise de commande.</li>
                <li>‚úçÔ∏è Envoie ta demande compl√®te avec commande + adresse + disponibilit√©s.</li>
                <li>üíµ R√®glement en liquide uniquement.</li>
            </ol>
            <p class="text-gray-300 mt-3">üì¶ On se d√©place jusqu‚Äô√† l‚Äôadresse de ton choix pour garantir une livraison s√©curis√©e & en toute discr√©tion.</p>
        `;
        
        return `
            <h2 class="text-3xl font-extrabold mb-6 text-white">üì≤ Contact & Protocoles</h2>
            
            <!-- 1. R√©seaux (Priorit√©) -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${reseauxContent}
            </div>

            <!-- 2. Meet-up -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${meetUpContent}
            </div>
            
            <!-- 3. Livraison / Envois Postaux (Regroup√©s) -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${livraisonContent}
            </div>
        `;
    }

    /** √âcran de Succ√®s apr√®s commande */
    function renderSuccessScreen() {
        const waLink = `https://wa.me/33759840764?text=Salut%20South%20Valley%2C%20mon%20code%20de%20v√©rification%20est%20${securityCode}%20!%20Mon%20ordre%20est%20envoy√©.%20%F0%9F%9A%80%F0%9F%8F%95%EF%B8%8F`;

        return `
            <div class="text-center p-6 text-white min-h-[60vh] flex flex-col justify-center items-center">
                <span class="text-7xl mb-6">‚úÖ</span>
                <h2 class="text-3xl font-extrabold mb-4" style="color: var(--color-primary);">ORDRE ENVOY√â !</h2>
                <p class="text-lg text-gray-300 mb-6">Votre ordre est en cours de traitement par notre Bot.</p>
                
                <div class="p-4 bg-gray-800 rounded-lg w-full max-w-xs mb-6">
                    <p class="text-xs text-gray-400">Votre Code de V√©rification Unique (√† utiliser sur WhatsApp) :</p>
                    <p class="text-2xl font-extrabold mt-1" style="color: var(--color-secondary);">${securityCode}</p>
                </div>

                <h3 class="text-xl font-bold mb-3" style="color: var(--color-secondary);">SUIVI IMM√âDIAT üöÄ</h3>
                <p class="text-sm text-gray-400 mb-4">Pour confirmer et obtenir les d√©tails de paiement/Meet-up :</p>
                
                <a href="${waLink}" target="_blank" class="w-full max-w-xs py-3 rounded-xl font-bold text-white bg-green-600 hover:bg-green-700 transition-colors flex items-center justify-center">
                    <span class="text-2xl mr-2">üü¢</span> Contacter le Standard
                </a>
            </div>
        `;
    }


    /** Ajoute un produit au panier */
    function addToCart(id, name, price) {
        // Le ID est maintenant le Tier ID pour l'unicit√© dans le panier
        const existingItem = cart.find(item => item.id === id);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            // Utiliser le nom complet (Nom + Poids) pour le panier
            cart.push({ id, name, price, quantity: 1 });
        }
        updateCartDisplay();
        closeModal();
        showNotification(`Article ajout√© au panier ! üõí`);
    }


    /** G√®re la s√©lection du paiement et la politique associ√©e */
    function setPayment(method) {
        document.getElementById('paymentMethod').value = method;
        const policyElement = document.getElementById('paymentPolicy');
        const policyContainer = document.getElementById('policyContainer');

        // Reset styles
        const cashBtn = document.getElementById('paymentCash');
        const cryptoBtn = document.getElementById('paymentCrypto');
        
        cashBtn.className = cashBtn.className.replace(' border-yellow-400 text-white', ' border-gray-700 text-gray-400');
        cryptoBtn.className = cryptoBtn.className.replace(' border-yellow-400 text-white', ' border-gray-700 text-gray-400');
        
        // Set new styles and policy text
        if (method === 'CASH') {
            cashBtn.className = cashBtn.className.replace(' border-gray-700 text-gray-400', ' border-yellow-400 text-white');
            policyElement.textContent = "CASH : Paiement au Rendez-vous (Meet-up) ou √† la Livraison. Le lieu s√©curis√© est confirm√© par le Bot apr√®s validation. ü§ù";
        } else if (method === 'CRYPTO') {
            cryptoBtn.className = cryptoBtn.className.replace(' border-gray-700 text-gray-400', ' border-yellow-400 text-white');
            policyElement.innerHTML = "CRYPTO : Paiement √† l'avance pour les **ENVOIS POSTAUX**. <br> <b>S√©curit√© :</b> Remboursement √† **50%** en cas de saisie (Taux de passage garanti √† 99% !).";
        }
        policyContainer.style.display = 'block';
    }


    /** G√®re l'envoi vers WhatsApp */
    function submitOrderWA(event) {
        // Emp√™cher le lien <a> d'ouvrir imm√©diatement la page (on veut la logique ici)
        if (event) {
            event.preventDefault(); 
        }

        const telegramPseudo = document.getElementById('telegramPseudo').value;
        const contactNumber = document.getElementById('contactNumber').value;
        const shippingName = document.getElementById('shippingName').value;
        const shippingAddress = document.getElementById('shippingAddress').value;
        const paymentMethod = document.getElementById('paymentMethod').value;
        const waLinkElement = document.getElementById('waLinkCheckout');

        if (!telegramPseudo || !contactNumber || !shippingName || !shippingAddress || !paymentMethod) {
            showNotification('Veuillez remplir tous les champs requis. üö´', 'red');
            return;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Construction du message WhatsApp (r√©sum√© complet)
        const orderDetails = cart.map(item => `   - ${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)`).join('\n');
        
        const waMessage = 
            `Salut SOUTH VALLEY ! üå¥\n\n` +
            `J'ai finalis√© mon ordre via le Command Center. Voici les d√©tails pour la suite :\n\n` +
            `üîí Mon Code de V√©rification : ${securityCode}\n\n` +
            `--- RAPPEL DE COMMANDE ---\n` +
            `${orderDetails}\n` +
            `TOTAL: ${total}‚Ç¨\n\n` +
            `M√âTHODE: ${paymentMethod}\n` +
            `NOM CLIENT: ${shippingName}\n` +
            `ADRESSE: ${shippingAddress}\n` +
            `CONTACT: ${contactNumber} / TG: ${telegramPseudo}\n\n` +
            `Merci de confirmer la marche √† suivre pour l'envoi/meet-up. üöÄ`;

        // Mise √† jour du lien A avec le message encod√©
        const encodedMessage = encodeURIComponent(waMessage);
        waLinkElement.href = `https://wa.me/33759840764?text=${encodedMessage}`;
        
        // Simuler l'envoi au Bot (pour le tracking et l'affichage du succ√®s)
        submitOrderBot(total, orderDetails);

        // Ouvrir WhatsApp apr√®s l'envoi au bot
        window.open(waLinkElement.href, '_blank');
    }

    /** Simule l'envoi de la commande au bot (pour le tracking interne) */
    function submitOrderBot(total, summary) {
        const orderData = {
            client_telegram: document.getElementById('telegramPseudo').value,
            client_contact: document.getElementById('contactNumber').value,
            client_name: document.getElementById('shippingName').value,
            total: total + '‚Ç¨',
            method: document.getElementById('paymentMethod').value,
            address: document.getElementById('shippingAddress').value,
            items: summary,
            security_code: securityCode,
            date: new Date().toISOString()
        };
        const jsonString = JSON.stringify(orderData, null, 2);

        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.sendData(jsonString);
        } else {
            console.warn("SDK Telegram non disponible. Commande simul√©e pour tracking.");
            console.log("--- JSON ENVOY√â √Ä LA CONSOLE ---", jsonString);
        }

        // Afficher l'√©cran de succ√®s
        cart = [];
        updateCartDisplay();
        changeScreen('success');
    }


    /** Met √† jour la quantit√© d'un produit dans le panier */
    function updateQuantity(index, delta) {
        if (cart[index].quantity + delta > 0) {
            cart[index].quantity += delta;
        } else if (cart[index].quantity + delta === 0) {
            cart.splice(index, 1);
        }
        changeScreen('cart');
        updateCartDisplay();
    }

    /** Retire un produit du panier */
    function removeItem(index) {
        const removedName = cart[index].name;
        cart.splice(index, 1);
        changeScreen('cart');
        updateCartDisplay();
        showNotification(`${removedName} retir√© du panier. üóëÔ∏è`);
    }

    /** Affiche une petite notification */
    function showNotification(message, color = 'green') {
        const notif = document.createElement('div');
        notif.textContent = message;
        notif.className = `fixed bottom-20 left-1/2 transform -translate-x-1/2 p-3 rounded-lg text-sm text-white shadow-xl transition-opacity duration-300 ${color === 'green' ? 'bg-green-600' : color === 'red' ? 'bg-red-600' : 'bg-yellow-600'}`;
        document.body.appendChild(notif);
        setTimeout(() => {
            notif.style.opacity = '0';
            setTimeout(() => notif.remove(), 300);
        }, 3000);
    }

    // --- INITIALISATION ---
    
    // Fonction d'initialisation appel√©e apr√®s un court d√©lai pour simuler le chargement
    function initializeApp() {
        // Cacher l'√©cran de chargement
        document.getElementById('loadingScreen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            // Tenter de d√©marrer la vid√©o de logo (ne d√©pend plus de l'autoplay)
            const videoElement = document.getElementById('logoVideo');
            videoElement.play().catch(e => console.log("Vid√©o de transition non lanc√©e (OK sur mobile)."));

            // Initialiser l'affichage
            changeScreen('menu');
            updateCartDisplay();
            
            // Si le SDK est l√†, initialiser l'app Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                // Adapter la couleur de l'app au th√®me Telegram
                document.body.style.backgroundColor = window.Telegram.WebApp.themeParams.bg_color || '#111827';
            }
        }, 500); // Temps pour la transition
    }

    // Lancer l'initialisation apr√®s le chargement du corps pour simuler un d√©marrage pro
    document.addEventListener('DOMContentLoaded', () => {
        // Remplacer l'ancien updateLoading par un simple timeout pour garantir le d√©marrage
        setTimeout(initializeApp, 1500); 
    });

</script>
</body>
</html>        .bottom-nav, header { 
            background-color: rgba(31, 41, 55, 0.95); /* Navigation plus opaque */
        }
        .loading-screen {
            background-color: var(--color-bg);
            z-index: 100;
        }
        /* Styles pour la vid√©o de chargement */
        .video-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            opacity: 0.2; /* Rend le fond subtil */
        }
        .video-container video {
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .loading-content {
            z-index: 10; /* Assure que le texte est au-dessus de la vid√©o */
        }
        /* --- IC√îNES CORPORATE --- */
        .icon-menu::before { content: '‚ò∞'; font-size: 20px; line-height: 1; }
        .icon-cart::before { content: 'üì¶'; font-size: 20px; line-height: 1; }
        .icon-contact::before { content: 'üìû'; font-size: 20px; line-height: 1; }
        .icon-cart-header::before { content: 'üì¶'; }
        
        /* Conteneur pour le logo flottant */
        #logoOverlay {
            width: 100%;
            height: 170px; /* Augment√© pour le logo plus visible */
            background-image: var(--logo-overlay-url);
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center 30px; 
        }
    </style>
</head>
<body>

<!-- Chargement du SDK Telegram Mini App (Crucial pour l'interaction avec le bot) -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Audio pour le fond sonore (musique YouTube fournie) -->
<audio id="backgroundAudio" loop>
    <!-- NOTE: URL de la musique YouTube non valide directement. Utiliser une version h√©berg√©e ou sans droits. -->
    <source src="https://www.youtube.com/watch?v=I7wJq8mPHFw" type="audio/mpeg" onerror="console.log('Lecture audio bloqu√©e par l\'utilisateur.');">
</audio>

<!-- √âcran de Chargement (Splash Screen) -->
<div id="loadingScreen" class="loading-screen fixed inset-0 flex flex-col items-center justify-center p-6 text-white transition-opacity duration-500">
    <!-- Vid√©o de transition en fond (Remplacer l'URL par votre vid√©o h√©berg√©e) -->
    <div class="video-container">
        <!-- URL Cloudinary pour la vid√©o de transition -->
        <video id="logoVideo" src="https://res.cloudinary.com/dlmmylat6/video/upload/v1764906501/Hailuo_Video_Please_try_to_make_the_image_m_449765216579096579_2_z65kit.mov" loop muted playsinline autoplay onerror="console.log('ERREUR: Vid√©o de logo non trouv√©e. Utilisez une URL de fichier .mp4 h√©berg√©e publiquement.')"></video>
    </div>

    <div class="loading-content relative flex flex-col items-center justify-center">
        <h1 class="text-4xl font-extrabold mt-4" style="color: var(--color-secondary);">SOUTH VALLEY üèúÔ∏è</h1>
        <p class="text-lg mt-1 font-semibold" style="color: var(--color-primary);">COMMAND CENTER | PLUG CERTIFI√â DEPUIS 2021</p>
        <div class="mt-8 w-3/4 bg-gray-700 rounded-full h-3">
            <div id="loadingBar" class="bg-yellow-400 h-3 rounded-full transition-all duration-1000" style="width: 0%;"></div>
        </div>
        <p id="loadingText" class="text-xs mt-3 text-gray-400">V√©rification de la S√©curit√© en cours...</p>
    </div>
</div>


<!-- Contenu de la Mini App -->
<div id="appContainer" class="min-h-screen pb-16 hidden">

    <!-- Header (Titre) -->
    <header class="p-4 border-b border-gray-700 flex justify-between items-center sticky top-0 z-10" style="background-color: #1f2937;">
        <h1 class="text-xl font-bold" style="color: var(--color-primary);">SOUTH VALLEY üèïÔ∏è</h1>
        <button onclick="changeScreen('cart')" class="text-white hover:text-yellow-400 transition-colors">
            <span class="icon-cart-header text-2xl" role="img" aria-label="Panier"></span>
            <span id="cartCount" class="text-xs bg-red-600 rounded-full px-2 py-0.5 ml-1">0</span>
        </button>
    </header>

    <!-- Zone de Contenu (Affichage des √âcrans) -->
    <main id="mainContent" class="p-4">
        <!-- Les diff√©rents √©crans seront inject√©s ici -->
    </main>

    <!-- Navigation du Bas (Footer) -->
    <footer class="bottom-nav fixed bottom-0 left-0 right-0 h-16 flex justify-around items-center border-t border-gray-700 text-gray-400 text-xs z-20">
        <button onclick="changeScreen('menu')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-menu"></span> Menu
        </button>
        <button onclick="changeScreen('cart')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-cart"></span> Panier
        </button>
        <button onclick="changeScreen('contact')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-contact"></span> Contact
        </button>
    </footer>

    <!-- Modal pour la s√©lection des tiers de produits -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-30 p-4">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-sm shadow-2xl text-white">
            <h3 id="modalTitle" class="text-2xl font-extrabold mb-4" style="color: var(--color-secondary);"></h3>
            
            <!-- Conteneur Vid√©o -->
            <div id="videoContainerModal" class="mb-4 aspect-video bg-black rounded-lg overflow-hidden">
                <video id="productVideo" src="" controls muted class="w-full h-full object-cover"></video>
            </div>
            
            <p id="modalDesc" class="text-sm text-gray-400 mb-4"></p>
            
            <div id="tiersContainer" class="space-y-3 max-h-48 overflow-y-auto pr-2">
                <!-- Tiers inject√©s ici -->
            </div>

            <button onclick="closeModal()" class="mt-6 w-full py-3 font-bold rounded-xl bg-gray-700 hover:bg-gray-600 transition-colors">
                ANNULER / FERMER
            </button>
        </div>
    </div>
</div>

<script>
    // --- VARIABLES GLOBALES ---
    let currentScreen = 'menu';
    let cart = [];
    let securityCode = ''; // Code de s√©curit√© g√©n√©r√© pour la commande
    
    // D√©finition de la structure complexe des produits
    const productData = [
        { 
            id: 'MC', 
            name: 'MONT√â CRISTO', 
            category: 'Snow Valley', 
            icon: '‚òÉÔ∏è',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906305/IMG_1629_ntkjra.mp4', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/94A3B8/111827?text=S-MC',
            desc: 'Un arrivage givr√©e ü•∂ - venu tout droit de Bolivie üáßüá¥, ce Mont√© Cristo‚Äô fr√¥le la puret√© avec un taux de 0.98% ! üå¨Ô∏è',
            tiers: [
                { w: '1.G', p: 60 }, { w: '2.G', p: 120 }, { w: '3.G', p: 160 }, 
                { w: '5.G', p: 260 }, { w: '10.G', p: 400 }, { w: '50.G', p: 1500 }, 
                { w: '100.G', p: 2800 }
            ]
        },
        { 
            id: 'PK', 
            name: 'Pink Kush', 
            category: 'Hash & Zaza Valley', 
            icon: 'üß¨',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906290/06AECEF5-7C0A-493C-9588-99433B454A4E_2_1_hnlzee.mov', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/10B981/111827?text=H-PK',
            desc: 'Restock de cette Cali tout droit venu de nos amis Californiens üá∫üá∏, un taux atteignant les 34% de THC ! üå¨Ô∏è',
            tiers: [
                { w: '5.G', p: 60 }, { w: '10.G', p: 120 }, { w: '25.G', p: 220 }, 
                { w: '50.G', p: 360 }, { w: '100.G', p: 640 }, { w: '500.G', p: 2200 }
            ]
        },
        { 
            id: 'SM', 
            name: 'SIMPSONS MOUSSE 2K25', 
            category: 'Hash & Zaza Valley', 
            icon: 'üßΩ',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906298/IMG_1715_rtit70.mp4', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/10B981/111827?text=H-SM',
            desc: 'Nouvel arrivage Simpsons Mousse üßΩü•á la famille, Mousse de qualit√©, √† consommer sans mod√©ration !ü´ß',
            tiers: [
                { w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 170 }, 
                { w: '100.G', p: 350 }
            ]
        },
        { 
            id: 'XM', 
            name: 'XALE‚Äô MOUSSE', 
            category: 'Hash & Zaza Valley', 
            icon: 'üßΩ',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906313/IMG_1819_i4ipsf.mp4', 
            // URL Miniature (Placeholder)
            thumbnailUrl: 'https://placehold.co/64x64/10B981/111827?text=H-XM',
            desc: 'Nouvel arrivage mousseux üßº, Top jaune mousseux, s‚Äôeffrite facilement, fumette de qualit√© assur√©e ! ü§ù',
            tiers: [
                { w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 160 }, 
                { w: '100.G', p: 330 }
            ]
        }
    ];

    // Mappage des IDs/Cat√©gories pour la navigation
    const productsByCategory = {
        'Hash & Zaza Valley': productData.filter(p => p.category === 'Hash & Zaza Valley'),
        'Snow Valley': productData.filter(p => p.category === 'Snow Valley')
    };

    // --- LOGIQUE UTILITAIRE ---
    
    /** Met √† jour le compteur du panier dans le header */
    function updateCartDisplay() {
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById('cartCount').textContent = count;
    }

    /** G√©n√®re un code de s√©curit√© unique SV + 4 chiffres */
    function generateSecurityCode() {
        const randomDigits = Math.floor(1000 + Math.random() * 9000);
        return `SV${randomDigits}`;
    }

    // --- LOGIQUE D'AFFICHAGE ET DE NAVIGATION ---

    /** Affiche l'√©cran s√©lectionn√© */
    function changeScreen(screenName, category = null) {
        currentScreen = screenName;
        const content = document.getElementById('mainContent');
        content.innerHTML = '';
        window.scrollTo(0, 0); 

        // Style pour indiquer l'√©cran actif (non impl√©ment√© pour la d√©mo, mais bonne pratique)
        // document.querySelectorAll('.bottom-nav button').forEach(btn => {/*...*/});

        switch (screenName) {
            case 'menu':
                content.innerHTML = renderMenuScreen();
                break;
            case 'products':
                content.innerHTML = renderProductsScreen(category);
                break;
            case 'cart':
                content.innerHTML = renderCartScreen();
                break;
            case 'checkout':
                // G√©n√©rer le code de s√©curit√© AVANT l'affichage du checkout
                securityCode = generateSecurityCode();
                content.innerHTML = renderCheckoutScreen();
                break;
            case 'contact':
                content.innerHTML = renderContactScreen();
                break;
            case 'success':
                content.innerHTML = renderSuccessScreen();
                break;
            default:
                content.innerHTML = renderMenuScreen();
        }
    }

    /** √âcran principal avec les deux cat√©gories */
    function renderMenuScreen() {
        return `
            <div class="text-white">
                <!-- LOGO FLOTTANT (visible au-dessus du fond, positionn√©) -->
                <div id="logoOverlay" class="w-full mb-4"></div>
                
                <h2 class="text-xl font-bold text-white text-center mb-6">D√âCOUVREZ NOS MENUS !</h2>
                
                <!-- Hash & Zaza Valley (Utilisation des classes pour la taille) -->
                <div onclick="changeScreen('products', 'Hash & Zaza Valley')" class="mb-4 p-4 rounded-xl cursor-pointer transition-transform hover:scale-[1.02] shadow-lg h-32 flex flex-col justify-center" style="background-color: #1f2937; border-left: 5px solid var(--color-primary);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--color-primary);">Hash & Zaza Valley ü™¥üòÆ‚Äçüí®</h3>
                            <p class="text-sm text-gray-300">S√©lection de Qualit√© & Premium | Coffee Quality Certifi√© üèÖ</p>
                        </div>
                        <span class="text-3xl">üöÄ</span>
                    </div>
                </div>

                <!-- Snow Valley -->
                <div onclick="changeScreen('products', 'Snow Valley')" class="mb-4 p-4 rounded-xl cursor-pointer transition-transform hover:scale-[1.02] shadow-lg" style="background-color: #1f2937; border-left: 5px solid var(--color-secondary);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--color-secondary);">Snow Valley üèîÔ∏èüå¨Ô∏è</h3>
                            <p class="text-sm text-gray-300">Une exp√©rience givr√©e & unique | Puret√© Garantie ! üèÖ</p>
                        </div>
                        <span class="text-3xl">üíé</span>
                    </div>
                </div>
                
                <!-- Statut de S√©curit√© (D√©plac√© en bas du contenu) -->
                <h2 class="text-xl font-bold mt-8 mb-2 text-center" style="color: var(--color-secondary);">PLUG CERTIFI√â DEPUIS 2021 üîå</h2>
            </div>
        `;
    }

    /** √âcran des produits pour une cat√©gorie donn√©e */
    function renderProductsScreen(category) {
        const productList = productsByCategory[category] || [];
        const color = category === 'Hash & Zaza Valley' ? 'var(--color-primary)' : 'var(--color-secondary)';
        
        return `
            <button onclick="changeScreen('menu')" class="text-gray-400 hover:text-white mb-4 flex items-center">
                <span class="text-xl mr-2">‚¨ÖÔ∏è</span> Retour Menu
            </button>
            <h2 class="text-3xl font-extrabold mb-6 text-white" style="color: ${color};">${category} üèïÔ∏è</h2>
            
            <div class="grid grid-cols-1 gap-4">
                ${productList.map(p => {
                    const lowestTier = p.tiers[0];
                    return `
                        <div class="bg-gray-800 rounded-lg p-4 shadow-xl flex items-center space-x-4">
                            <!-- Miniature Vid√©o/Image -->
                            <div class="w-20 h-20 bg-black rounded-lg flex-shrink-0 relative overflow-hidden" onclick="openModal('${p.id}')">
                                <video src="${p.videoUrl}" muted playsinline class="w-full h-full object-cover"></video>
                                <span class="absolute inset-0 flex items-center justify-center text-4xl text-white opacity-80 cursor-pointer">‚ñ∂Ô∏è</span>
                            </div>

                            <!-- Infos Produit -->
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-white mb-1">${p.icon} ${p.name}</h3>
                                <p class="text-sm text-gray-400 mb-2">${p.desc.length > 50 ? p.desc.substring(0, 50) + '...' : p.desc}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-extrabold" style="color: ${color};">${lowestTier.p}‚Ç¨ / ${lowestTier.w}</span>
                                    <button onclick="openModal('${p.id}')" class="bg-yellow-600 text-black px-3 py-1 rounded-full font-bold hover:bg-yellow-700 transition-colors flex items-center text-sm">
                                        Choisir ‚û°Ô∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    }

    /** Ouvre le modal de s√©lection des tiers de prix et charge la vid√©o */
    function openModal(productId) {
        const product = productData.find(p => p.id === productId);
        if (!product) return;

        document.getElementById('modalTitle').textContent = `${product.icon} ${product.name}`;
        document.getElementById('modalDesc').textContent = product.desc;

        // Afficher la vid√©o
        const videoElement = document.getElementById('productVideo');
        videoElement.src = product.videoUrl;
        
        // Charger la vid√©o mais ne pas d√©marrer la lecture (l'utilisateur doit cliquer)
        videoElement.load();

        const tiersHTML = product.tiers.map(tier => `
            <div class="flex justify-between items-center p-3 rounded-lg bg-gray-700">
                <span class="font-semibold">${tier.w}</span>
                <span class="font-extrabold" style="color: var(--color-primary);">${tier.p}‚Ç¨</span>
                <button 
                    onclick="addToCart('${product.id}_${tier.w}', '${product.name} (${tier.w})', ${tier.p})" 
                    class="bg-green-600 text-white px-3 py-1 text-sm rounded-full hover:bg-green-700 transition-colors"
                >
                    Ajouter üõí
                </button>
            </div>
        `).join('');

        document.getElementById('tiersContainer').innerHTML = tiersHTML;
        document.getElementById('productModal').classList.remove('hidden');
    }

    /** Ferme le modal */
    function closeModal() {
        // Stopper la vid√©o quand le modal est ferm√©
        const videoElement = document.getElementById('productVideo');
        videoElement.pause();
        document.getElementById('productModal').classList.add('hidden');
    }

    /** √âcran du Panier est le m√™me mais utilise la nouvelle structure */
    function renderCartScreen() {
        // ... (Pas de changement majeur, la structure existante fonctionne pour l'affichage)
        if (cart.length === 0) {
            return `
                <h2 class="text-3xl font-extrabold mb-6 text-white">üì¶ Mon Panier</h2>
                <div class="text-center p-10 bg-gray-800 rounded-lg text-gray-400">
                    <p class="text-xl">Votre panier est vide.</p>
                    <p class="mt-2">Ajoutez des produits de la s√©lection Prestige pour commander.</p>
                    <button onclick="changeScreen('menu')" class="mt-6 text-sm text-yellow-400 hover:text-yellow-500">
                        Explorer le Catalogue
                    </button>
                </div>
            `;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        return `
            <h2 class="text-3xl font-extrabold mb-6 text-white">üì¶ Mon Panier</h2>
            <div class="space-y-4">
                ${cart.map((item, index) => `
                    <div class="bg-gray-800 rounded-lg p-3 flex justify-between items-center text-white">
                        <div class="flex-1">
                            <p class="font-bold">${item.name}</p>
                            <p class="text-sm text-gray-400">${item.price}‚Ç¨ x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${index}, -1)" class="text-xl bg-gray-700 w-8 h-8 rounded-full">-</button>
                            <span class="w-4 text-center">${item.quantity}</span>
                            <button onclick="updateQuantity(${index}, 1)" class="text-xl bg-gray-700 w-8 h-8 rounded-full">+</button>
                            <button onclick="removeItem(${index})" class="text-red-500 hover:text-red-400 ml-3">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div class="mt-8 p-4 bg-gray-800 rounded-lg text-white">
                <p class="text-xl font-bold">TOTAL : <span class="float-right" style="color: var(--color-secondary);">${total}‚Ç¨</span></p>
            </div>

            <button onclick="changeScreen('checkout')" class="mt-6 w-full py-4 text-lg font-bold rounded-xl text-black transition-colors bg-yellow-400 hover:bg-yellow-500">
                PASSER AU CHECKOUT S√âCURIS√â üí≥
            </button>
        `;
    }


    /** √âcran de Paiement et Checkout */
    function renderCheckoutScreen() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Construction du r√©sum√© pour WhatsApp
        const orderDetails = cart.map(item => `   - ${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)`).join('\n');
        
        // D√©finir la fonction submitOrderWA comme callback pour le lien A
        const waLinkHref = "javascript:submitOrderWA(event);";

        return `
            <button onclick="changeScreen('cart')" class="text-gray-400 hover:text-white mb-4 flex items-center">
                <span class="text-xl mr-2">‚¨ÖÔ∏è</span> Retour Panier
            </button>
            <h2 class="text-3xl font-extrabold mb-6 text-white">üîí CHECKOUT S√âCURIS√â</h2>
            
            <div class="space-y-4 text-white">
                <p class="text-xl font-bold mb-4">TOTAL √Ä PAYER : <span style="color: var(--color-primary);">${total}‚Ç¨</span></p>

                <!-- V√©rification obligatoire -->
                <div class="p-3 rounded-lg text-sm bg-red-800 bg-opacity-30 border border-red-700">
                    <h3 class="font-bold text-red-400 mb-1">‚ö†Ô∏è V√âRIFICATION OBLIGATOIRE</h3>
                    <p class="text-xs text-gray-300">Pour toute <b>premi√®re commande</b>, la validation finale n√©cessite l'envoi d'une photo de votre **CNI & un Selfie** au Standard WhatsApp. Protocole de s√©curit√©. üõ°Ô∏è</p>
                </div>


                <!-- R√©sum√© de la Commande (Affichage) -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">R√âSUM√â DE L'ORDRE</h3>
                <div class="p-3 bg-gray-800 rounded-lg text-sm">
                    ${cart.map(item => `<p class="text-gray-300">${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)</p>`).join('')}
                </div>
                <p class="text-lg font-bold mt-3">TOTAL: <span class="float-right" style="color: var(--color-primary);">${total}‚Ç¨</span></p>

                <!-- Formulaire de Contact -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">1. Contact (Protocole)</h3>
                <input type="text" id="telegramPseudo" placeholder="Pseudo Telegram (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:border-yellow-400">
                <input type="text" id="contactNumber" placeholder="Num√©ro WhatsApp/Telegram (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:focus:border-yellow-400">
                <p class="text-xs text-gray-400 mt-1">Ceci garantit la discr√©tion et le suivi de votre ordre. üì≤</p>

                <!-- Formulaire de Livraison -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">2. Adresse de Livraison</h3>
                <input type="text" id="shippingName" placeholder="Nom Complet pour l'envoi (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:focus:border-yellow-400">
                <input type="text" id="shippingAddress" placeholder="Adresse compl√®te (Rue, Ville, Code Postal)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:border-yellow-400">
                
                <!-- Choix du Paiement -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">3. M√©thode de Paiement</h3>
                <div class="flex space-x-4">
                    <button id="paymentCash" onclick="setPayment('CASH')" class="flex-1 py-3 px-4 rounded-lg font-bold transition-all border-2 border-gray-700 text-gray-400 hover:border-yellow-400">
                        <span class="text-2xl">üíµ</span> CASH (Meet-up/Livraison)
                    </button>
                    <button id="paymentCrypto" onclick="setPayment('CRYPTO')" class="flex-1 py-3 px-4 rounded-lg font-bold transition-all border-2 border-gray-700 text-gray-400 hover:border-yellow-400">
                        <span class="text-2xl">‚Çø</span> CRYPTO (Postal)
                    </button>
                </div>
                <input type="hidden" id="paymentMethod" value="">
                
                <div id="policyContainer" class="mt-4 p-3 rounded-lg text-sm" style="background-color: #2D3748;">
                    <p class="font-bold text-white">Politique de Paiement :</p>
                    <p id="paymentPolicy" class="text-gray-300 mt-1 text-xs">Veuillez s√©lectionner une m√©thode pour afficher la politique de s√©curit√© associ√©e. üõ°Ô∏è</p>
                </div>


                <a id="waLinkCheckout" href="${waLinkHref}" target="_blank" onclick="submitOrderWA(event)" class="mt-8 w-full py-4 text-lg font-bold rounded-xl text-white transition-colors bg-green-600 hover:bg-green-700 flex items-center justify-center">
                    <span class="text-2xl mr-2">üü¢</span> VALIDER MA COMMANDE
                </a>
            </div>
        `;
    }
    
    /** √âcran Contact */
    function renderContactScreen() {
        // D√©finition de la couleur pour les titres secondaires des modalit√©s (Vert Emeraude, couleur primaire)
        const secondaryColor = 'var(--color-primary)'; 
        
        // Contenu des diff√©rentes sections du Bot de base
        const reseauxContent = `
            <h3 class="text-xl font-bold mt-2 mb-2" style="color: ${secondaryColor};">üåê Nos R√©seaux</h3>
            <p class="text-gray-300">Retrouvez-nous sur nos diff√©rentes plateformes pour suivre nos actualit√©s et rester connect√© √† South Valley ! üèúÔ∏è</p>
            <div class="mt-3 space-y-2">
                <a href="https://t.me/SouthValleyFarm" target="_blank" class="block py-2 rounded-lg font-bold bg-blue-600 text-white text-center">Canal Telegram Officiel üîµ</a>
                <a href="https://dympt.org/SouthV" target="_blank" class="block py-2 rounded-lg font-bold bg-gray-700 text-white text-center">POTATO ü•î</a>
                <a href="https://wa.me/33759840764" target="_blank" class="block py-2 rounded-lg font-bold bg-green-600 text-white text-center">What'sApp üü¢</a>
                <a href="https://linktr.ee/southvalleyfarm" target="_blank" class="mt-3 block py-2 rounded-lg font-bold bg-yellow-600 text-black text-center">üì≤ Tous nos r√©seaux</a>
            </div>
        `;

        const meetUpContent = `
            <h3 class="text-xl font-bold mt-6 mb-2" style="color: ${secondaryColor};">ü§ù M33T-UP South Valley</h3>
            <p class="text-gray-300">Nos meet-ups se d√©roulent dans le 92, √† une adresse discr√®te et sans vis-√†-vis pour garantir votre confort et votre s√©curit√©. üòá</p>
            <p class="text-gray-300">Desservie par la Ligne 13 - RER C & RER L ! ü•á</p>
            <p class="text-gray-300 mt-2">üï∞Ô∏è Horaires : 10:30 √† 2:00</p>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üìå Modalit√©s de commande :</h4>
            <ol class="list-decimal list-inside text-gray-400 text-sm space-y-1">
                <li>üÜî V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</li>
                <li>üõç Consulte le menu via notre bot & diff√©rents canaux.</li>
                <li>‚úçÔ∏è Envoie ta commande compl√®te.</li>
                <li>üí¨ On te communique l‚Äôadresse & l‚Äôitin√©raire.</li>
                <li>üö∂‚Äç‚ôÇÔ∏èTu passes r√©cup√©rer ta commande.</li>
            </ol>
        `;

        const livraisonContent = `
            <h3 class="text-xl font-bold mt-6 mb-2" style="color: ${secondaryColor};">üì¶ Livraisons South Valley ! üèúÔ∏è</h3>
            <p class="text-gray-300">Nous desservons toute l‚Äô√éle-de-France et certaines zones hors IDF.</p>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üì¶ Zones Couvertes :</h4>
            <ul class="list-disc list-inside text-gray-400 text-sm space-y-1">
                <li>√éle-de-France compl√®te üá´üá∑ (Min. : 60‚Ç¨ ü§ù)</li>
                <li>R√©gions limitrophes (28 / 60 / 45 / 02 / 89 / 27 / 10) (Min. : 200‚Ç¨ ü§ù)</li>
            </ul>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üìå Modalit√©s de commande :</h4>
            <ol class="list-decimal list-inside text-gray-400 text-sm space-y-1">
                <li>üÜî V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</li>
                <li>‚ö†Ô∏è Pr√©-commande lors des sessions de prise de commande.</li>
                <li>‚úçÔ∏è Envoie ta demande compl√®te avec commande + adresse + disponibilit√©s.</li>
                <li>üíµ R√®glement en liquide uniquement.</li>
            </ol>
            <p class="text-gray-300 mt-3">üì¶ On se d√©place jusqu‚Äô√† l‚Äôadresse de ton choix pour garantir une livraison s√©curis√©e & en toute discr√©tion.</p>
        `;
        
        return `
            <h2 class="text-3xl font-extrabold mb-6 text-white">üì≤ Contact & Protocoles</h2>
            
            <!-- 1. R√©seaux (Priorit√©) -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${reseauxContent}
            </div>

            <!-- 2. Meet-up -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${meetUpContent}
            </div>
            
            <!-- 3. Livraison / Envois Postaux (Regroup√©s) -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${livraisonContent}
            </div>
        `;
    }

    /** √âcran de Succ√®s apr√®s commande */
    function renderSuccessScreen() {
        const waLink = `https://wa.me/33759840764?text=Salut%20South%20Valley%2C%20mon%20code%20de%20v√©rification%20est%20${securityCode}%20!%20Mon%20ordre%20est%20envoy√©.%20%F0%9F%9A%80%F0%9F%8F%95%EF%B8%8F`;

        return `
            <div class="text-center p-6 text-white min-h-[60vh] flex flex-col justify-center items-center">
                <span class="text-7xl mb-6">‚úÖ</span>
                <h2 class="text-3xl font-extrabold mb-4" style="color: var(--color-primary);">ORDRE ENVOY√â !</h2>
                <p class="text-lg text-gray-300 mb-6">Votre ordre est en cours de traitement par notre Bot.</p>
                
                <div class="p-4 bg-gray-800 rounded-lg w-full max-w-xs mb-6">
                    <p class="text-xs text-gray-400">Votre Code de V√©rification Unique (√† utiliser sur WhatsApp) :</p>
                    <p class="text-2xl font-extrabold mt-1" style="color: var(--color-secondary);">${securityCode}</p>
                </div>

                <h3 class="text-xl font-bold mb-3" style="color: var(--color-secondary);">SUIVI IMM√âDIAT üöÄ</h3>
                <p class="text-sm text-gray-400 mb-4">Pour confirmer et obtenir les d√©tails de paiement/Meet-up :</p>
                
                <a href="${waLink}" target="_blank" class="w-full max-w-xs py-3 rounded-xl font-bold text-white bg-green-600 hover:bg-green-700 transition-colors flex items-center justify-center">
                    <span class="text-2xl mr-2">üü¢</span> Contacter le Standard
                </a>
            </div>
        `;
    }


    /** Ajoute un produit au panier */
    function addToCart(id, name, price) {
        // Le ID est maintenant le Tier ID pour l'unicit√© dans le panier
        const existingItem = cart.find(item => item.id === id);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            // Utiliser le nom complet (Nom + Poids) pour le panier
            cart.push({ id, name, price, quantity: 1 });
        }
        updateCartDisplay();
        closeModal();
        showNotification(`Article ajout√© au panier ! üõí`);
    }


    /** G√®re la s√©lection du paiement et la politique associ√©e */
    function setPayment(method) {
        document.getElementById('paymentMethod').value = method;
        const policyElement = document.getElementById('paymentPolicy');
        const policyContainer = document.getElementById('policyContainer');

        // Reset styles
        const cashBtn = document.getElementById('paymentCash');
        const cryptoBtn = document.getElementById('paymentCrypto');
        
        cashBtn.className = cashBtn.className.replace(' border-yellow-400 text-white', ' border-gray-700 text-gray-400');
        cryptoBtn.className = cryptoBtn.className.replace(' border-yellow-400 text-white', ' border-gray-700 text-gray-400');
        
        // Set new styles and policy text
        if (method === 'CASH') {
            cashBtn.className = cashBtn.className.replace(' border-gray-700 text-gray-400', ' border-yellow-400 text-white');
            policyElement.textContent = "CASH : Paiement au Rendez-vous (Meet-up) ou √† la Livraison. Le lieu s√©curis√© est confirm√© par le Bot apr√®s validation. ü§ù";
        } else if (method === 'CRYPTO') {
            cryptoBtn.className = cryptoBtn.className.replace(' border-gray-700 text-gray-400', ' border-yellow-400 text-white');
            policyElement.innerHTML = "CRYPTO : Paiement √† l'avance pour les **ENVOIS POSTAUX**. <br> <b>S√©curit√© :</b> Remboursement √† **50%** en cas de saisie (Taux de passage garanti √† 99% !).";
        }
        policyContainer.style.display = 'block';
    }


    /** G√®re l'envoi vers WhatsApp */
    function submitOrderWA(event) {
        // Emp√™cher le lien <a> d'ouvrir imm√©diatement la page (on veut la logique ici)
        if (event) {
            event.preventDefault(); 
        }

        const telegramPseudo = document.getElementById('telegramPseudo').value;
        const contactNumber = document.getElementById('contactNumber').value;
        const shippingName = document.getElementById('shippingName').value;
        const shippingAddress = document.getElementById('shippingAddress').value;
        const paymentMethod = document.getElementById('paymentMethod').value;
        const waLinkElement = document.getElementById('waLinkCheckout');

        if (!telegramPseudo || !contactNumber || !shippingName || !shippingAddress || !paymentMethod) {
            showNotification('Veuillez remplir tous les champs requis. üö´', 'red');
            return;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Construction du message WhatsApp (r√©sum√© complet)
        const orderDetails = cart.map(item => `   - ${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)`).join('\n');
        
        const waMessage = 
            `Salut SOUTH VALLEY ! üå¥\n\n` +
            `J'ai finalis√© mon ordre via le Command Center. Voici les d√©tails pour la suite :\n\n` +
            `üîí Mon Code de V√©rification : ${securityCode}\n\n` +
            `--- RAPPEL DE COMMANDE ---\n` +
            `${orderDetails}\n` +
            `TOTAL: ${total}‚Ç¨\n\n` +
            `M√âTHODE: ${paymentMethod}\n` +
            `NOM CLIENT: ${shippingName}\n` +
            `ADRESSE: ${shippingAddress}\n` +
            `CONTACT: ${contactNumber} / TG: ${telegramPseudo}\n\n` +
            `Merci de confirmer la marche √† suivre pour l'envoi/meet-up. üöÄ`;

        // Mise √† jour du lien A avec le message encod√©
        const encodedMessage = encodeURIComponent(waMessage);
        waLinkElement.href = `https://wa.me/33759840764?text=${encodedMessage}`;
        
        // Simuler l'envoi au Bot (pour le tracking et l'affichage du succ√®s)
        submitOrderBot(total, orderDetails);

        // Ouvrir WhatsApp apr√®s l'envoi au bot
        window.open(waLinkElement.href, '_blank');
    }

    /** Simule l'envoi de la commande au bot (pour le tracking interne) */
    function submitOrderBot(total, summary) {
        const orderData = {
            client_telegram: document.getElementById('telegramPseudo').value,
            client_contact: document.getElementById('contactNumber').value,
            client_name: document.getElementById('shippingName').value,
            total: total + '‚Ç¨',
            method: document.getElementById('paymentMethod').value,
            address: document.getElementById('shippingAddress').value,
            items: summary,
            security_code: securityCode,
            date: new Date().toISOString()
        };
        const jsonString = JSON.stringify(orderData, null, 2);

        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.sendData(jsonString);
        } else {
            console.warn("SDK Telegram non disponible. Commande simul√©e pour tracking.");
            console.log("--- JSON ENVOY√â √Ä LA CONSOLE ---", jsonString);
        }

        // Afficher l'√©cran de succ√®s
        cart = [];
        updateCartDisplay();
        changeScreen('success');
    }


    /** Met √† jour la quantit√© d'un produit dans le panier */
    function updateQuantity(index, delta) {
        if (cart[index].quantity + delta > 0) {
            cart[index].quantity += delta;
        } else if (cart[index].quantity + delta === 0) {
            cart.splice(index, 1);
        }
        changeScreen('cart');
        updateCartDisplay();
    }

    /** Retire un produit du panier */
    function removeItem(index) {
        const removedName = cart[index].name;
        cart.splice(index, 1);
        changeScreen('cart');
        updateCartDisplay();
        showNotification(`${removedName} retir√© du panier. üóëÔ∏è`);
    }

    /** Affiche une petite notification */
    function showNotification(message, color = 'green') {
        const notif = document.createElement('div');
        notif.textContent = message;
        notif.className = `fixed bottom-20 left-1/2 transform -translate-x-1/2 p-3 rounded-lg text-sm text-white shadow-xl transition-opacity duration-300 ${color === 'green' ? 'bg-green-600' : color === 'red' ? 'bg-red-600' : 'bg-yellow-600'}`;
        document.body.appendChild(notif);
        setTimeout(() => {
            notif.style.opacity = '0';
            setTimeout(() => notif.remove(), 300);
        }, 3000);
    }

    // --- INITIALISATION ---
    
    // Fonction d'initialisation appel√©e apr√®s un court d√©lai pour simuler le chargement
    function initializeApp() {
        // Cacher l'√©cran de chargement
        document.getElementById('loadingScreen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            // Tenter de d√©marrer l'audio (sera souvent bloqu√© par les navigateurs sans interaction)
            const audio = document.getElementById('backgroundAudio');
            audio.play().catch(e => console.log("Lecture audio bloqu√©e par l'utilisateur."));

            // Initialiser l'affichage
            changeScreen('menu');
            updateCartDisplay();
            
            // Si le SDK est l√†, initialiser l'app Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                // Adapter la couleur de l'app au th√®me Telegram
                document.body.style.backgroundColor = window.Telegram.WebApp.themeParams.bg_color || '#111827';
            }
        }, 500); // Temps pour la transition
    }

    // G√©rer l'animation de la barre de chargement
    let loadingProgress = 0;
    const loadingBar = document.getElementById('loadingBar');
    const loadingText = document.getElementById('loadingText');
    const loadingMessages = [
        "D√©marrage du Command Center...",
        "Authentification de la Source Cali...",
        "Optimisation de la Logistique S√©curis√©e...",
        "Acc√®s √† la Chambre Forte d√©bloqu√©..."
    ];
    let messageIndex = 0;

    function updateLoading() {
        loadingProgress += 10;
        if (loadingProgress > 100) loadingProgress = 100;
        
        loadingBar.style.width = `${loadingProgress}%`;

        if (loadingProgress > 25 * (messageIndex + 1) && messageIndex < loadingMessages.length) {
            loadingText.textContent = loadingMessages[messageIndex];
            messageIndex++;
        }

        if (loadingProgress < 100) {
            setTimeout(updateLoading, 200);
        }
    }

    // Lancer l'initialisation apr√®s le chargement du corps pour simuler un d√©marrage pro
    document.addEventListener('DOMContentLoaded', () => {
        updateLoading();
        // Simuler un temps de chargement pour l'effet "splash screen"
        setTimeout(initializeApp, 3000); // Temps ajust√© pour l'animation de la barre de chargement
    });

</script>
</body>
</html>        .bottom-nav, header { 
            background-color: rgba(31, 41, 55, 0.95); /* Navigation plus opaque */
        }
        .loading-screen {
            background-color: var(--color-bg);
            z-index: 100;
        }
        /* Styles pour la vid√©o de chargement */
        .video-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            opacity: 0.2; /* Rend le fond subtil */
        }
        .video-container video {
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .loading-content {
            z-index: 10; /* Assure que le texte est au-dessus de la vid√©o */
        }
        /* --- IC√îNES CORPORATE --- */
        .icon-menu::before { content: '‚ò∞'; font-size: 20px; line-height: 1; }
        .icon-cart::before { content: 'üì¶'; font-size: 20px; line-height: 1; }
        .icon-contact::before { content: 'üìû'; font-size: 20px; line-height: 1; }
        .icon-cart-header::before { content: 'üì¶'; }
        
        /* Conteneur pour le logo flottant */
        #logoOverlay {
            width: 100%;
            height: 170px; /* Augment√© pour le logo plus visible */
            background-image: var(--logo-overlay-url);
            background-size: contain; 
            background-repeat: no-repeat;
            background-position: center 30px; 
        }
    </style>
</head>
<body>

<!-- Chargement du SDK Telegram Mini App (Crucial pour l'interaction avec le bot) -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Audio pour le fond sonore (musique YouTube fournie) -->
<audio id="backgroundAudio" loop>
    <!-- NOTE: URL de la musique YouTube non valide directement. Utiliser une version h√©berg√©e ou sans droits. -->
    <source src="https://www.youtube.com/watch?v=I7wJq8mPHFw" type="audio/mpeg" onerror="console.log('Lecture audio bloqu√©e par l\'utilisateur.');">
</audio>

<!-- √âcran de Chargement (Splash Screen) -->
<div id="loadingScreen" class="loading-screen fixed inset-0 flex flex-col items-center justify-center p-6 text-white transition-opacity duration-500">
    <!-- Vid√©o de transition en fond (Remplacer l'URL par votre vid√©o h√©berg√©e) -->
    <div class="video-container">
        <!-- URL Cloudinary pour la vid√©o de transition -->
        <video id="logoVideo" src="https://res.cloudinary.com/dlmmylat6/video/upload/v1764906501/Hailuo_Video_Please_try_to_make_the_image_m_449765216579096579_2_z65kit.mov" loop muted playsinline autoplay onerror="console.log('ERREUR: Vid√©o de logo non trouv√©e. Utilisez une URL de fichier .mp4 h√©berg√©e publiquement.')"></video>
    </div>

    <div class="loading-content relative flex flex-col items-center justify-center">
        <h1 class="text-4xl font-extrabold mt-4" style="color: var(--color-secondary);">SOUTH VALLEY üèúÔ∏è</h1>
        <p class="text-lg mt-1 font-semibold" style="color: var(--color-primary);">COMMAND CENTER | PLUG CERTIFI√â DEPUIS 2021</p>
        <div class="mt-8 w-3/4 bg-gray-700 rounded-full h-3">
            <div id="loadingBar" class="bg-yellow-400 h-3 rounded-full transition-all duration-1000" style="width: 0%;"></div>
        </div>
        <p id="loadingText" class="text-xs mt-3 text-gray-400">V√©rification de la S√©curit√© en cours...</p>
    </div>
</div>


<!-- Contenu de la Mini App -->
<div id="appContainer" class="min-h-screen pb-16 hidden">

    <!-- Header (Titre) -->
    <header class="p-4 border-b border-gray-700 flex justify-between items-center sticky top-0 z-10" style="background-color: #1f2937;">
        <h1 class="text-xl font-bold" style="color: var(--color-primary);">SOUTH VALLEY üèïÔ∏è</h1>
        <button onclick="changeScreen('cart')" class="text-white hover:text-yellow-400 transition-colors">
            <span class="icon-cart-header text-2xl" role="img" aria-label="Panier"></span>
            <span id="cartCount" class="text-xs bg-red-600 rounded-full px-2 py-0.5 ml-1">0</span>
        </button>
    </header>

    <!-- Zone de Contenu (Affichage des √âcrans) -->
    <main id="mainContent" class="p-4">
        <!-- Les diff√©rents √©crans seront inject√©s ici -->
    </main>

    <!-- Navigation du Bas (Footer) -->
    <footer class="bottom-nav fixed bottom-0 left-0 right-0 h-16 flex justify-around items-center border-t border-gray-700 text-gray-400 text-xs z-20">
        <button onclick="changeScreen('menu')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-menu"></span> Menu
        </button>
        <button onclick="changeScreen('cart')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-cart"></span> Panier
        </button>
        <button onclick="changeScreen('contact')" class="flex flex-col items-center hover:text-white transition-colors">
            <span class="icon-contact"></span> Contact
        </button>
    </footer>

    <!-- Modal pour la s√©lection des tiers de produits -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-30 p-4">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-sm shadow-2xl text-white">
            <h3 id="modalTitle" class="text-2xl font-extrabold mb-4" style="color: var(--color-secondary);"></h3>
            
            <!-- Conteneur Vid√©o -->
            <div id="videoContainerModal" class="mb-4 aspect-video bg-black rounded-lg overflow-hidden">
                <video id="productVideo" src="" controls muted class="w-full h-full object-cover"></video>
            </div>
            
            <p id="modalDesc" class="text-sm text-gray-400 mb-4"></p>
            
            <div id="tiersContainer" class="space-y-3 max-h-48 overflow-y-auto pr-2">
                <!-- Tiers inject√©s ici -->
            </div>

            <button onclick="closeModal()" class="mt-6 w-full py-3 font-bold rounded-xl bg-gray-700 hover:bg-gray-600 transition-colors">
                ANNULER / FERMER
            </button>
        </div>
    </div>
</div>

<script>
    // --- VARIABLES GLOBALES ---
    let currentScreen = 'menu';
    let cart = [];
    let securityCode = ''; // Code de s√©curit√© g√©n√©r√© pour la commande
    
    // D√©finition de la structure complexe des produits
    const productData = [
        { 
            id: 'MC', 
            name: 'MONT√â CRISTO', 
            category: 'Snow Valley', 
            icon: '‚òÉÔ∏è',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906305/IMG_1629_ntkjra.mp4', 
            desc: 'Un arrivage givr√©e ü•∂ - venu tout droit de Bolivie üáßüá¥, ce Mont√© Cristo‚Äô fr√¥le la puret√© avec un taux de 0.98% ! üå¨Ô∏è',
            tiers: [
                { w: '1.G', p: 60 }, { w: '2.G', p: 120 }, { w: '3.G', p: 160 }, 
                { w: '5.G', p: 260 }, { w: '10.G', p: 400 }, { w: '50.G', p: 1500 }, 
                { w: '100.G', p: 2800 }
            ]
        },
        { 
            id: 'PK', 
            name: 'Pink Kush', 
            category: 'Hash & Zaza Valley', 
            icon: 'üß¨',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906290/06AECEF5-7C0A-493C-9588-99433B454A4E_2_1_hnlzee.mov', 
            desc: 'Restock de cette Cali tout droit venu de nos amis Californiens üá∫üá∏, un taux atteignant les 34% de THC ! üå¨Ô∏è',
            tiers: [
                { w: '5.G', p: 60 }, { w: '10.G', p: 120 }, { w: '25.G', p: 220 }, 
                { w: '50.G', p: 360 }, { w: '100.G', p: 640 }, { w: '500.G', p: 2200 }
            ]
        },
        { 
            id: 'SM', 
            name: 'SIMPSONS MOUSSE 2K25', 
            category: 'Hash & Zaza Valley', 
            icon: 'üßΩ',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906298/IMG_1715_rtit70.mp4', 
            desc: 'Nouvel arrivage Simpsons Mousse üßΩü•á la famille, Mousse de qualit√©, √† consommer sans mod√©ration !ü´ß',
            tiers: [
                { w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 170 }, 
                { w: '100.G', p: 350 }
            ]
        },
        { 
            id: 'XM', 
            name: 'XALE‚Äô MOUSSE', 
            category: 'Hash & Zaza Valley', 
            icon: 'üßΩ',
            // URL Vid√©o : Cloudinary
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906313/IMG_1819_i4ipsf.mp4', 
            desc: 'Nouvel arrivage mousseux üßº, Top jaune mousseux, s‚Äôeffrite facilement, fumette de qualit√© assur√©e ! ü§ù',
            tiers: [
                { w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 160 }, 
                { w: '100.G', p: 330 }
            ]
        }
    ];

    // Mappage des IDs/Cat√©gories pour la navigation
    const productsByCategory = {
        'Hash & Zaza Valley': productData.filter(p => p.category === 'Hash & Zaza Valley'),
        'Snow Valley': productData.filter(p => p.category === 'Snow Valley')
    };

    // --- LOGIQUE UTILITAIRE ---
    
    /** Met √† jour le compteur du panier dans le header */
    function updateCartDisplay() {
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        document.getElementById('cartCount').textContent = count;
    }

    /** G√©n√®re un code de s√©curit√© unique SV + 4 chiffres */
    function generateSecurityCode() {
        const randomDigits = Math.floor(1000 + Math.random() * 9000);
        return `SV${randomDigits}`;
    }

    // --- LOGIQUE D'AFFICHAGE ET DE NAVIGATION ---

    /** Affiche l'√©cran s√©lectionn√© */
    function changeScreen(screenName, category = null) {
        currentScreen = screenName;
        const content = document.getElementById('mainContent');
        content.innerHTML = '';
        window.scrollTo(0, 0); 

        // Style pour indiquer l'√©cran actif (non impl√©ment√© pour la d√©mo, mais bonne pratique)
        // document.querySelectorAll('.bottom-nav button').forEach(btn => {/*...*/});

        switch (screenName) {
            case 'menu':
                content.innerHTML = renderMenuScreen();
                break;
            case 'products':
                content.innerHTML = renderProductsScreen(category);
                break;
            case 'cart':
                content.innerHTML = renderCartScreen();
                break;
            case 'checkout':
                // G√©n√©rer le code de s√©curit√© AVANT l'affichage du checkout
                securityCode = generateSecurityCode();
                content.innerHTML = renderCheckoutScreen();
                break;
            case 'contact':
                content.innerHTML = renderContactScreen();
                break;
            case 'success':
                content.innerHTML = renderSuccessScreen();
                break;
            default:
                content.innerHTML = renderMenuScreen();
        }
    }

    /** √âcran principal avec les deux cat√©gories */
    function renderMenuScreen() {
        return `
            <div class="text-white">
                <!-- LOGO FLOTTANT (visible au-dessus du fond, positionn√©) -->
                <div id="logoOverlay" class="w-full mb-4"></div>
                
                <h2 class="text-xl font-bold text-white text-center mb-6">D√âCOUVREZ NOS MENUS !</h2>
                
                <!-- Hash & Zaza Valley (Utilisation des classes pour la taille) -->
                <div onclick="changeScreen('products', 'Hash & Zaza Valley')" class="mb-4 p-4 rounded-xl cursor-pointer transition-transform hover:scale-[1.02] shadow-lg h-32 flex flex-col justify-center" style="background-color: #1f2937; border-left: 5px solid var(--color-primary);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--color-primary);">Hash & Zaza Valley ü™¥üòÆ‚Äçüí®</h3>
                            <p class="text-sm text-gray-300">S√©lection de Qualit√© & Premium | Coffee Quality Certifi√© üèÖ</p>
                        </div>
                        <span class="text-3xl">üöÄ</span>
                    </div>
                </div>

                <!-- Snow Valley -->
                <div onclick="changeScreen('products', 'Snow Valley')" class="mb-4 p-4 rounded-xl cursor-pointer transition-transform hover:scale-[1.02] shadow-lg" style="background-color: #1f2937; border-left: 5px solid var(--color-secondary);">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold" style="color: var(--color-secondary);">Snow Valley üèîÔ∏èüå¨Ô∏è</h3>
                            <p class="text-sm text-gray-300">Une exp√©rience givr√©e & unique | Puret√© Garantie ! üèÖ</p>
                        </div>
                        <span class="text-3xl">üíé</span>
                    </div>
                </div>
                
                <!-- Statut de S√©curit√© (D√©plac√© en bas du contenu) -->
                <h2 class="text-xl font-bold mt-8 mb-2 text-center" style="color: var(--color-secondary);">PLUG CERTIFI√â DEPUIS 2021 üîå</h2>
            </div>
        `;
    }

    /** √âcran des produits pour une cat√©gorie donn√©e */
    function renderProductsScreen(category) {
        const productList = productsByCategory[category] || [];
        const color = category === 'Hash & Zaza Valley' ? 'var(--color-primary)' : 'var(--color-secondary)';
        
        return `
            <button onclick="changeScreen('menu')" class="text-gray-400 hover:text-white mb-4 flex items-center">
                <span class="text-xl mr-2">‚¨ÖÔ∏è</span> Retour Menu
            </button>
            <h2 class="text-3xl font-extrabold mb-6 text-white" style="color: ${color};">${category} üèïÔ∏è</h2>
            
            <div class="grid grid-cols-1 gap-4">
                ${productList.map(p => {
                    const lowestTier = p.tiers[0];
                    return `
                        <div class="bg-gray-800 rounded-lg p-4 shadow-xl">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-2xl font-bold text-white">${p.icon} ${p.name}</h3>
                                <span class="text-lg font-extrabold" style="color: ${color};">${lowestTier.p}‚Ç¨ / ${lowestTier.w}</span>
                            </div>
                            <p class="text-sm text-gray-400 mt-1 mb-4">${p.desc}</p>
                            
                            <button onclick="openModal('${p.id}')" class="bg-yellow-600 text-black px-4 py-2 rounded-full font-bold hover:bg-yellow-700 transition-colors flex items-center justify-center w-full">
                                Choisir Quantit√© <span class="text-lg ml-2">‚û°Ô∏è</span>
                            </button>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    }

    /** Ouvre le modal de s√©lection des tiers de prix et charge la vid√©o */
    function openModal(productId) {
        const product = productData.find(p => p.id === productId);
        if (!product) return;

        document.getElementById('modalTitle').textContent = `${product.icon} ${product.name}`;
        document.getElementById('modalDesc').textContent = product.desc;

        // Afficher la vid√©o
        const videoElement = document.getElementById('productVideo');
        videoElement.src = product.videoUrl;
        
        // Charger la vid√©o mais ne pas d√©marrer la lecture (l'utilisateur doit cliquer)
        videoElement.load();

        const tiersHTML = product.tiers.map(tier => `
            <div class="flex justify-between items-center p-3 rounded-lg bg-gray-700">
                <span class="font-semibold">${tier.w}</span>
                <span class="font-extrabold" style="color: var(--color-primary);">${tier.p}‚Ç¨</span>
                <button 
                    onclick="addToCart('${product.id}_${tier.w}', '${product.name} (${tier.w})', ${tier.p})" 
                    class="bg-green-600 text-white px-3 py-1 text-sm rounded-full hover:bg-green-700 transition-colors"
                >
                    Ajouter üõí
                </button>
            </div>
        `).join('');

        document.getElementById('tiersContainer').innerHTML = tiersHTML;
        document.getElementById('productModal').classList.remove('hidden');
    }

    /** Ferme le modal */
    function closeModal() {
        // Stopper la vid√©o quand le modal est ferm√©
        const videoElement = document.getElementById('productVideo');
        videoElement.pause();
        document.getElementById('productModal').classList.add('hidden');
    }

    /** √âcran du Panier est le m√™me mais utilise la nouvelle structure */
    function renderCartScreen() {
        // ... (Pas de changement majeur, la structure existante fonctionne pour l'affichage)
        if (cart.length === 0) {
            return `
                <h2 class="text-3xl font-extrabold mb-6 text-white">üì¶ Mon Panier</h2>
                <div class="text-center p-10 bg-gray-800 rounded-lg text-gray-400">
                    <p class="text-xl">Votre panier est vide.</p>
                    <p class="mt-2">Ajoutez des produits de la s√©lection Prestige pour commander.</p>
                    <button onclick="changeScreen('menu')" class="mt-6 text-sm text-yellow-400 hover:text-yellow-500">
                        Explorer le Catalogue
                    </button>
                </div>
            `;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        return `
            <h2 class="text-3xl font-extrabold mb-6 text-white">üì¶ Mon Panier</h2>
            <div class="space-y-4">
                ${cart.map((item, index) => `
                    <div class="bg-gray-800 rounded-lg p-3 flex justify-between items-center text-white">
                        <div class="flex-1">
                            <p class="font-bold">${item.name}</p>
                            <p class="text-sm text-gray-400">${item.price}‚Ç¨ x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateQuantity(${index}, -1)" class="text-xl bg-gray-700 w-8 h-8 rounded-full">-</button>
                            <span class="w-4 text-center">${item.quantity}</span>
                            <button onclick="updateQuantity(${index}, 1)" class="text-xl bg-gray-700 w-8 h-8 rounded-full">+</button>
                            <button onclick="removeItem(${index})" class="text-red-500 hover:text-red-400 ml-3">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div class="mt-8 p-4 bg-gray-800 rounded-lg text-white">
                <p class="text-xl font-bold">TOTAL : <span class="float-right" style="color: var(--color-secondary);">${total}‚Ç¨</span></p>
            </div>

            <button onclick="changeScreen('checkout')" class="mt-6 w-full py-4 text-lg font-bold rounded-xl text-black transition-colors bg-yellow-400 hover:bg-yellow-500">
                PASSER AU CHECKOUT S√âCURIS√â üí≥
            </button>
        `;
    }


    /** √âcran de Paiement et Checkout */
    function renderCheckoutScreen() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Construction du r√©sum√© pour WhatsApp
        const orderDetails = cart.map(item => `   - ${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)`).join('\n');
        
        // D√©finir la fonction submitOrderWA comme callback pour le lien A
        const waLinkHref = "javascript:submitOrderWA(event);";

        return `
            <button onclick="changeScreen('cart')" class="text-gray-400 hover:text-white mb-4 flex items-center">
                <span class="text-xl mr-2">‚¨ÖÔ∏è</span> Retour Panier
            </button>
            <h2 class="text-3xl font-extrabold mb-6 text-white">üîí CHECKOUT S√âCURIS√â</h2>
            
            <div class="space-y-4 text-white">
                <p class="text-xl font-bold mb-4">TOTAL √Ä PAYER : <span style="color: var(--color-primary);">${total}‚Ç¨</span></p>

                <!-- V√©rification obligatoire -->
                <div class="p-3 rounded-lg text-sm bg-red-800 bg-opacity-30 border border-red-700">
                    <h3 class="font-bold text-red-400 mb-1">‚ö†Ô∏è V√âRIFICATION OBLIGATOIRE</h3>
                    <p class="text-xs text-gray-300">Pour toute <b>premi√®re commande</b>, la validation finale n√©cessite l'envoi d'une photo de votre **CNI & un Selfie** au Standard WhatsApp. Protocole de s√©curit√©. üõ°Ô∏è</p>
                </div>


                <!-- R√©sum√© de la Commande (Affichage) -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">R√âSUM√â DE L'ORDRE</h3>
                <div class="p-3 bg-gray-800 rounded-lg text-sm">
                    ${cart.map(item => `<p class="text-gray-300">${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)</p>`).join('')}
                </div>
                <p class="text-lg font-bold mt-3">TOTAL: <span class="float-right" style="color: var(--color-primary);">${total}‚Ç¨</span></p>

                <!-- Formulaire de Contact -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">1. Contact (Protocole)</h3>
                <input type="text" id="telegramPseudo" placeholder="Pseudo Telegram (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:border-yellow-400">
                <input type="text" id="contactNumber" placeholder="Num√©ro WhatsApp/Telegram (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:focus:border-yellow-400">
                <p class="text-xs text-gray-400 mt-1">Ceci garantit la discr√©tion et le suivi de votre ordre. üì≤</p>

                <!-- Formulaire de Livraison -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">2. Adresse de Livraison</h3>
                <input type="text" id="shippingName" placeholder="Nom Complet pour l'envoi (Requis)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:focus:border-yellow-400">
                <input type="text" id="shippingAddress" placeholder="Adresse compl√®te (Rue, Ville, Code Postal)" class="w-full p-3 rounded bg-gray-800 border border-gray-700 focus:ring-yellow-400 focus:border-yellow-400">
                
                <!-- Choix du Paiement -->
                <h3 class="text-xl font-bold mt-6 mb-3" style="color: var(--color-secondary);">3. M√©thode de Paiement</h3>
                <div class="flex space-x-4">
                    <button id="paymentCash" onclick="setPayment('CASH')" class="flex-1 py-3 px-4 rounded-lg font-bold transition-all border-2 border-gray-700 text-gray-400 hover:border-yellow-400">
                        <span class="text-2xl">üíµ</span> CASH (Meet-up/Livraison)
                    </button>
                    <button id="paymentCrypto" onclick="setPayment('CRYPTO')" class="flex-1 py-3 px-4 rounded-lg font-bold transition-all border-2 border-gray-700 text-gray-400 hover:border-yellow-400">
                        <span class="text-2xl">‚Çø</span> CRYPTO (Postal)
                    </button>
                </div>
                <input type="hidden" id="paymentMethod" value="">
                
                <div id="policyContainer" class="mt-4 p-3 rounded-lg text-sm" style="background-color: #2D3748;">
                    <p class="font-bold text-white">Politique de Paiement :</p>
                    <p id="paymentPolicy" class="text-gray-300 mt-1 text-xs">Veuillez s√©lectionner une m√©thode pour afficher la politique de s√©curit√© associ√©e. üõ°Ô∏è</p>
                </div>


                <a id="waLinkCheckout" href="${waLinkHref}" target="_blank" onclick="submitOrderWA(event)" class="mt-8 w-full py-4 text-lg font-bold rounded-xl text-white transition-colors bg-green-600 hover:bg-green-700 flex items-center justify-center">
                    <span class="text-2xl mr-2">üü¢</span> VALIDER MA COMMANDE
                </a>
            </div>
        `;
    }
    
    /** √âcran Contact */
    function renderContactScreen() {
        // D√©finition de la couleur pour les titres secondaires des modalit√©s (Vert Emeraude, couleur primaire)
        const secondaryColor = 'var(--color-primary)'; 
        
        // Contenu des diff√©rentes sections du Bot de base
        const reseauxContent = `
            <h3 class="text-xl font-bold mt-2 mb-2" style="color: ${secondaryColor};">üåê Nos R√©seaux</h3>
            <p class="text-gray-300">Retrouvez-nous sur nos diff√©rentes plateformes pour suivre nos actualit√©s et rester connect√© √† South Valley ! üèúÔ∏è</p>
            <div class="mt-3 space-y-2">
                <a href="https://t.me/SouthValleyFarm" target="_blank" class="block py-2 rounded-lg font-bold bg-blue-600 text-white text-center">Canal Telegram Officiel üîµ</a>
                <a href="https://dympt.org/SouthV" target="_blank" class="block py-2 rounded-lg font-bold bg-gray-700 text-white text-center">POTATO ü•î</a>
                <a href="https://wa.me/33759840764" target="_blank" class="block py-2 rounded-lg font-bold bg-green-600 text-white text-center">What'sApp üü¢</a>
                <a href="https://linktr.ee/southvalleyfarm" target="_blank" class="mt-3 block py-2 rounded-lg font-bold bg-yellow-600 text-black text-center">üì≤ Tous nos r√©seaux</a>
            </div>
        `;

        const meetUpContent = `
            <h3 class="text-xl font-bold mt-6 mb-2" style="color: ${secondaryColor};">ü§ù M33T-UP South Valley</h3>
            <p class="text-gray-300">Nos meet-ups se d√©roulent dans le 92, √† une adresse discr√®te et sans vis-√†-vis pour garantir votre confort et votre s√©curit√©. üòá</p>
            <p class="text-gray-300">Desservie par la Ligne 13 - RER C & RER L ! ü•á</p>
            <p class="text-gray-300 mt-2">üï∞Ô∏è Horaires : 10:30 √† 2:00</p>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üìå Modalit√©s de commande :</h4>
            <ol class="list-decimal list-inside text-gray-400 text-sm space-y-1">
                <li>üÜî V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</li>
                <li>üõç Consulte le menu via notre bot & diff√©rents canaux.</li>
                <li>‚úçÔ∏è Envoie ta commande compl√®te.</li>
                <li>üí¨ On te communique l‚Äôadresse & l‚Äôitin√©raire.</li>
                <li>üö∂‚Äç‚ôÇÔ∏èTu passes r√©cup√©rer ta commande.</li>
            </ol>
        `;

        const livraisonContent = `
            <h3 class="text-xl font-bold mt-6 mb-2" style="color: ${secondaryColor};">üì¶ Livraisons South Valley ! üèúÔ∏è</h3>
            <p class="text-gray-300">Nous desservons toute l‚Äô√éle-de-France et certaines zones hors IDF.</p>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üì¶ Zones Couvertes :</h4>
            <ul class="list-disc list-inside text-gray-400 text-sm space-y-1">
                <li>√éle-de-France compl√®te üá´üá∑ (Min. : 60‚Ç¨ ü§ù)</li>
                <li>R√©gions limitrophes (28 / 60 / 45 / 02 / 89 / 27 / 10) (Min. : 200‚Ç¨ ü§ù)</li>
            </ul>
            <h4 class="font-bold mt-4" style="color: var(--color-secondary);">üìå Modalit√©s de commande :</h4>
            <ol class="list-decimal list-inside text-gray-400 text-sm space-y-1">
                <li>üÜî V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</li>
                <li>‚ö†Ô∏è Pr√©-commande lors des sessions de prise de commande.</li>
                <li>‚úçÔ∏è Envoie ta demande compl√®te avec commande + adresse + disponibilit√©s.</li>
                <li>üíµ R√®glement en liquide uniquement.</li>
            </ol>
            <p class="text-gray-300 mt-3">üì¶ On se d√©place jusqu‚Äô√† l‚Äôadresse de ton choix pour garantir une livraison s√©curis√©e & en toute discr√©tion.</p>
        `;
        
        return `
            <h2 class="text-3xl font-extrabold mb-6 text-white">üì≤ Contact & Protocoles</h2>
            
            <!-- 1. R√©seaux (Priorit√©) -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${reseauxContent}
            </div>

            <!-- 2. Meet-up -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${meetUpContent}
            </div>
            
            <!-- 3. Livraison / Envois Postaux (Regroup√©s) -->
            <div class="p-4 rounded-xl mb-4" style="background-color: #1f2937;">
                ${livraisonContent}
            </div>
        `;
    }

    /** √âcran de Succ√®s apr√®s commande */
    function renderSuccessScreen() {
        const waLink = `https://wa.me/33759840764?text=Salut%20South%20Valley%2C%20mon%20code%20de%20v√©rification%20est%20${securityCode}%20!%20Mon%20ordre%20est%20envoy√©.%20%F0%9F%9A%80%F0%9F%8F%95%EF%B8%8F`;

        return `
            <div class="text-center p-6 text-white min-h-[60vh] flex flex-col justify-center items-center">
                <span class="text-7xl mb-6">‚úÖ</span>
                <h2 class="text-3xl font-extrabold mb-4" style="color: var(--color-primary);">ORDRE ENVOY√â !</h2>
                <p class="text-lg text-gray-300 mb-6">Votre ordre est en cours de traitement par notre Bot.</p>
                
                <div class="p-4 bg-gray-800 rounded-lg w-full max-w-xs mb-6">
                    <p class="text-xs text-gray-400">Votre Code de V√©rification Unique (√† utiliser sur WhatsApp) :</p>
                    <p class="text-2xl font-extrabold mt-1" style="color: var(--color-secondary);">${securityCode}</p>
                </div>

                <h3 class="text-xl font-bold mb-3" style="color: var(--color-secondary);">SUIVI IMM√âDIAT üöÄ</h3>
                <p class="text-sm text-gray-400 mb-4">Pour confirmer et obtenir les d√©tails de paiement/Meet-up :</p>
                
                <a href="${waLink}" target="_blank" class="w-full max-w-xs py-3 rounded-xl font-bold text-white bg-green-600 hover:bg-green-700 transition-colors flex items-center justify-center">
                    <span class="text-2xl mr-2">üü¢</span> Contacter le Standard
                </a>
            </div>
        `;
    }


    /** Ajoute un produit au panier */
    function addToCart(id, name, price) {
        // Le ID est maintenant le Tier ID pour l'unicit√© dans le panier
        const existingItem = cart.find(item => item.id === id);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            // Utiliser le nom complet (Nom + Poids) pour le panier
            cart.push({ id, name, price, quantity: 1 });
        }
        updateCartDisplay();
        closeModal();
        showNotification(`Article ajout√© au panier ! üõí`);
    }


    /** G√®re la s√©lection du paiement et la politique associ√©e */
    function setPayment(method) {
        document.getElementById('paymentMethod').value = method;
        const policyElement = document.getElementById('paymentPolicy');
        const policyContainer = document.getElementById('policyContainer');

        // Reset styles
        const cashBtn = document.getElementById('paymentCash');
        const cryptoBtn = document.getElementById('paymentCrypto');
        
        cashBtn.className = cashBtn.className.replace(' border-yellow-400 text-white', ' border-gray-700 text-gray-400');
        cryptoBtn.className = cryptoBtn.className.replace(' border-yellow-400 text-white', ' border-gray-700 text-gray-400');
        
        // Set new styles and policy text
        if (method === 'CASH') {
            cashBtn.className = cashBtn.className.replace(' border-gray-700 text-gray-400', ' border-yellow-400 text-white');
            policyElement.textContent = "CASH : Paiement au Rendez-vous (Meet-up) ou √† la Livraison. Le lieu s√©curis√© est confirm√© par le Bot apr√®s validation. ü§ù";
        } else if (method === 'CRYPTO') {
            cryptoBtn.className = cryptoBtn.className.replace(' border-gray-700 text-gray-400', ' border-yellow-400 text-white');
            policyElement.innerHTML = "CRYPTO : Paiement √† l'avance pour les **ENVOIS POSTAUX**. <br> <b>S√©curit√© :</b> Remboursement √† **50%** en cas de saisie (Taux de passage garanti √† 99% !).";
        }
        policyContainer.style.display = 'block';
    }


    /** G√®re l'envoi vers WhatsApp */
    function submitOrderWA(event) {
        // Emp√™cher le lien <a> d'ouvrir imm√©diatement la page (on veut la logique ici)
        if (event) {
            event.preventDefault(); 
        }

        const telegramPseudo = document.getElementById('telegramPseudo').value;
        const contactNumber = document.getElementById('contactNumber').value;
        const shippingName = document.getElementById('shippingName').value;
        const shippingAddress = document.getElementById('shippingAddress').value;
        const paymentMethod = document.getElementById('paymentMethod').value;
        const waLinkElement = document.getElementById('waLinkCheckout');

        if (!telegramPseudo || !contactNumber || !shippingName || !shippingAddress || !paymentMethod) {
            showNotification('Veuillez remplir tous les champs requis. üö´', 'red');
            return;
        }

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // Construction du message WhatsApp (r√©sum√© complet)
        const orderDetails = cart.map(item => `   - ${item.quantity}x ${item.name} (${item.price}‚Ç¨/u)`).join('\n');
        
        const waMessage = 
            `Salut SOUTH VALLEY ! üå¥\n\n` +
            `J'ai finalis√© mon ordre via le Command Center. Voici les d√©tails pour la suite :\n\n` +
            `üîí Mon Code de V√©rification : ${securityCode}\n\n` +
            `--- RAPPEL DE COMMANDE ---\n` +
            `${orderDetails}\n` +
            `TOTAL: ${total}‚Ç¨\n\n` +
            `M√âTHODE: ${paymentMethod}\n` +
            `NOM CLIENT: ${shippingName}\n` +
            `ADRESSE: ${shippingAddress}\n` +
            `CONTACT: ${contactNumber} / TG: ${telegramPseudo}\n\n` +
            `Merci de confirmer la marche √† suivre pour l'envoi/meet-up. üöÄ`;

        // Mise √† jour du lien A avec le message encod√©
        const encodedMessage = encodeURIComponent(waMessage);
        waLinkElement.href = `https://wa.me/33759840764?text=${encodedMessage}`;
        
        // Simuler l'envoi au Bot (pour le tracking et l'affichage du succ√®s)
        submitOrderBot(total, orderDetails);

        // Ouvrir WhatsApp apr√®s l'envoi au bot
        window.open(waLinkElement.href, '_blank');
    }

    /** Simule l'envoi de la commande au bot (pour le tracking interne) */
    function submitOrderBot(total, summary) {
        const orderData = {
            client_telegram: document.getElementById('telegramPseudo').value,
            client_contact: document.getElementById('contactNumber').value,
            client_name: document.getElementById('shippingName').value,
            total: total + '‚Ç¨',
            method: document.getElementById('paymentMethod').value,
            address: document.getElementById('shippingAddress').value,
            items: summary,
            security_code: securityCode,
            date: new Date().toISOString()
        };
        const jsonString = JSON.stringify(orderData, null, 2);

        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.sendData(jsonString);
        } else {
            console.warn("SDK Telegram non disponible. Commande simul√©e pour tracking.");
            console.log("--- JSON ENVOY√â √Ä LA CONSOLE ---", jsonString);
        }

        // Afficher l'√©cran de succ√®s
        cart = [];
        updateCartDisplay();
        changeScreen('success');
    }


    /** Met √† jour la quantit√© d'un produit dans le panier */
    function updateQuantity(index, delta) {
        if (cart[index].quantity + delta > 0) {
            cart[index].quantity += delta;
        } else if (cart[index].quantity + delta === 0) {
            cart.splice(index, 1);
        }
        changeScreen('cart');
        updateCartDisplay();
    }

    /** Retire un produit du panier */
    function removeItem(index) {
        const removedName = cart[index].name;
        cart.splice(index, 1);
        changeScreen('cart');
        updateCartDisplay();
        showNotification(`${removedName} retir√© du panier. üóëÔ∏è`);
    }

    /** Affiche une petite notification */
    function showNotification(message, color = 'green') {
        const notif = document.createElement('div');
        notif.textContent = message;
        notif.className = `fixed bottom-20 left-1/2 transform -translate-x-1/2 p-3 rounded-lg text-sm text-white shadow-xl transition-opacity duration-300 ${color === 'green' ? 'bg-green-600' : color === 'red' ? 'bg-red-600' : 'bg-yellow-600'}`;
        document.body.appendChild(notif);
        setTimeout(() => {
            notif.style.opacity = '0';
            setTimeout(() => notif.remove(), 300);
        }, 3000);
    }

    // --- INITIALISATION ---
    
    // Fonction d'initialisation appel√©e apr√®s un court d√©lai pour simuler le chargement
    function initializeApp() {
        // Cacher l'√©cran de chargement
        document.getElementById('loadingScreen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            // Tenter de d√©marrer l'audio (sera souvent bloqu√© par les navigateurs sans interaction)
            const audio = document.getElementById('backgroundAudio');
            audio.play().catch(e => console.log("Lecture audio bloqu√©e par l'utilisateur."));

            // Initialiser l'affichage
            changeScreen('menu');
            updateCartDisplay();
            
            // Si le SDK est l√†, initialiser l'app Telegram
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                // Adapter la couleur de l'app au th√®me Telegram
                document.body.style.backgroundColor = window.Telegram.WebApp.themeParams.bg_color || '#111827';
            }
        }, 500); // Temps pour la transition
    }

    // G√©rer l'animation de la barre de chargement
    let loadingProgress = 0;
    const loadingBar = document.getElementById('loadingBar');
    const loadingText = document.getElementById('loadingText');
    const loadingMessages = [
        "D√©marrage du Command Center...",
        "Authentification de la Source Cali...",
        "Optimisation de la Logistique S√©curis√©e...",
        "Acc√®s √† la Chambre Forte d√©bloqu√©..."
    ];
    let messageIndex = 0;

    function updateLoading() {
        loadingProgress += 10;
        if (loadingProgress > 100) loadingProgress = 100;
        
        loadingBar.style.width = `${loadingProgress}%`;

        if (loadingProgress > 25 * (messageIndex + 1) && messageIndex < loadingMessages.length) {
            loadingText.textContent = loadingMessages[messageIndex];
            messageIndex++;
        }

        if (loadingProgress < 100) {
            setTimeout(updateLoading, 200);
        }
    }

    // Lancer l'initialisation apr√®s le chargement du corps pour simuler un d√©marrage pro
    document.addEventListener('DOMContentLoaded', () => {
        updateLoading();
        // Simuler un temps de chargement pour l'effet "splash screen"
        setTimeout(initializeApp, 3000); // Temps ajust√© pour l'animation de la barre de chargement
    });

</script>
</body>
</html>
