<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOUTH VALLEY - Christmas Edition</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- TH√àME "NO√ãL ONYX" --- */
        :root {
            --bg-deep: #050505;          /* Noir Absolu */
            --bg-card: #121212;          /* Gris Nuit */
            --bg-card-highlight: #202020; 
            
            /* ACCENT FESTIF (Or Chaud) */
            --primary-accent: #f59e0b;   
            --primary-glow: rgba(245, 158, 11, 0.4); 
            
            --text-main: #ffffff;
            --text-muted: #a3a3a3;
            --border-subtle: #333333;
            --success: #10b981;
            --danger: #ef4444;
        }
        
        body { 
            background-color: var(--bg-deep); 
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Arri√®re-plan Hivernal */
        .app-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(to bottom, rgba(5,5,5,0.8), var(--bg-deep)), url('https://res.cloudinary.com/dlmmylat6/image/upload/v1764915497/Sans_titre_Votre_story_dquj0q.png');
            background-size: cover; background-position: center; z-index: -2;
        }

        /* --- EFFET NEIGE --- */
        #snow-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: -1; overflow: hidden;
        }
        .snowflake {
            position: absolute; top: -10px;
            color: white; opacity: 0.8;
            font-size: 1em; user-select: none;
            animation-name: fall; animation-timing-function: linear; animation-iteration-count: infinite;
        }
        @keyframes fall { to { transform: translateY(105vh); } }

        /* --- UX COMPONENTS --- */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .glass-card {
            background-color: rgba(18, 18, 18, 0.85);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        }
        
        .glass-card.favorite {
            border: 1px solid var(--primary-accent);
            box-shadow: 0 0 15px var(--primary-glow);
        }
        
        .btn-main {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: #000; font-weight: 800; border-radius: 14px;
            box-shadow: 0 4px 20px var(--primary-glow);
            transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 0.5px;
            position: relative; overflow: hidden;
        }
        .btn-main:active { transform: scale(0.96); }

        .btn-main::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-20deg);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer { 
            0%, 70% { left: -100%; } 
            100% { left: 200%; } 
        }

        .btn-ghost {
            background-color: rgba(255,255,255,0.08);
            color: var(--text-main); border: 1px solid var(--border-subtle);
            border-radius: 12px; font-weight: 600;
        }

        .input-modern {
            background-color: rgba(0,0,0,0.4);
            border: 1px solid var(--border-subtle);
            color: white; border-radius: 12px; padding: 12px; width: 100%;
        }
        .input-modern:focus { border-color: var(--primary-accent); outline: none; box-shadow: 0 0 0 2px var(--primary-glow); }

        .service-opt, .payment-opt { transition: all 0.2s; cursor: pointer; }
        .service-opt.active, .payment-opt.active {
            border-color: var(--primary-accent) !important;
            background-color: rgba(245, 158, 11, 0.15) !important;
            color: white !important;
        }

        .nav-bar {
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(16px);
            border-top: 1px solid var(--border-subtle);
            padding-bottom: env(safe-area-inset-bottom);
            position: fixed; bottom: 0; left: 0; right: 0; z-index: 50;
        }
        .nav-btn.active { color: var(--primary-accent); }
        .nav-btn.active svg { filter: drop-shadow(0 0 8px var(--primary-glow)); }

        .mini-map-container {
            width: 100%; height: 160px; overflow: hidden;
            border-radius: 12px; border: 1px solid var(--border-subtle);
            background-color: #050505; position: relative; margin: 12px 0;
        }
        .mini-map-img { width: 100%; height: 100%; object-fit: contain; opacity: 0.9; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="antialiased">

<!-- Fond & Neige -->
<div class="app-background"></div>
<div id="snow-container"></div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- LOADING -->
<div id="loadingScreen" class="fixed inset-0 z-[60] flex flex-col items-center justify-center bg-[--bg-deep] transition-opacity duration-500">
    <img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765067656/Sans_titre_Logo_wjtljl.png" alt="Logo" class="h-24 animate-pulse mb-4 drop-shadow-[0_0_15px_rgba(245,158,11,0.5)]">
    <div class="text-[--primary-accent] text-sm font-bold tracking-widest uppercase mb-4">√âdition Hivernale ‚ùÑÔ∏è</div>
    <div class="w-8 h-8 border-4 border-t-[--primary-accent] border-white/10 rounded-full animate-spin"></div>
</div>

<!-- APP -->
<div id="appContainer" class="hidden min-h-screen flex flex-col pb-32 relative">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 px-6 py-3 flex justify-between items-center bg-[rgba(5,5,5,0.9)] backdrop-blur-md border-b border-[--border-subtle]">
        <div class="relative" onclick="changeScreen('menu')">
            <img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765067656/Sans_titre_Logo_wjtljl.png" alt="South Valley" class="h-14 w-auto object-contain cursor-pointer">
            <span class="absolute -top-1 -right-2 text-xl filter drop-shadow-md">üéÖ</span>
        </div>
        <!-- Bouton Panier avec zone de touche √©tendue (p-4 -mr-2) -->
        <button onclick="changeScreen('cart')" class="relative p-4 -mr-2 active:scale-95 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
            <span id="cartCount" class="absolute top-2 right-1 bg-[--primary-accent] text-black text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm border border-black">0</span>
        </button>
    </header>

    <!-- MAIN -->
    <main id="mainContent" class="flex-1 px-4 py-6 w-full max-w-md mx-auto"></main>

    <!-- NAV BAR -->
    <nav class="nav-bar">
        <div class="flex justify-around items-center h-16">
            <button onclick="changeScreen('menu')" id="nav-menu" class="nav-btn flex flex-col items-center justify-center w-full h-full text-[--text-muted] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                <span class="text-[10px]">QG</span>
            </button>
            <button onclick="changeScreen('products', 'Hash & Zaza Valley')" id="nav-products" class="nav-btn flex flex-col items-center justify-center w-full h-full text-[--text-muted] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
                <span class="text-[10px]">Menu</span>
            </button>
            <button onclick="changeScreen('contact')" id="nav-contact" class="nav-btn flex flex-col items-center justify-center w-full h-full text-[--text-muted] transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                <span class="text-[10px]">Infos</span>
            </button>
        </div>
    </nav>

    <!-- PRODUCT MODAL -->
    <div id="productModal" class="fixed inset-0 z-[60] hidden flex items-end sm:items-center justify-center bg-black/90 backdrop-blur-sm p-4 animate-fade-in">
        <div class="bg-[--bg-card] w-full max-w-sm rounded-2xl border border-[--border-subtle] shadow-2xl overflow-hidden flex flex-col h-[80vh]">
            <div class="relative w-full h-48 bg-black flex-shrink-0">
                <video id="productVideo" src="" controls muted class="w-full h-full object-cover"></video>
                <button onclick="closeModal()" class="absolute top-2 right-2 bg-black/60 text-white rounded-full p-2 hover:bg-white/20 z-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="p-5 flex flex-col flex-1 overflow-y-auto">
                <h3 id="modalTitle" class="text-2xl font-bold text-[--primary-accent] mb-2"></h3>
                <p id="modalDesc" class="text-sm text-[--text-muted] mb-6 leading-relaxed border-b border-[--border-subtle] pb-4"></p>
                <h4 class="text-sm font-bold text-white mb-3 uppercase">S√©lectionner une quantit√© :</h4>
                <div class="flex-1 space-y-3 pb-4" id="tiersContainer"></div>
            </div>
        </div>
    </div>

</div>

<script>
    let currentScreen = 'menu';
    let cart = [];
    let securityCode = '';

    // --- HAPTICS HELPER ---
    function triggerHaptic() {
        if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
            window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        }
    }

    // --- DATA ---
    const productData = [
        { 
            id: 'MC', name: 'MONT√â CRISTO', category: 'Snow Valley', icon: '‚ùÑÔ∏è', 
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906305/IMG_1629_ntkjra.mp4', 
            desc: 'Origine Bolivie üáßüá¥. Puret√© exceptionnelle (0.98%). Une exp√©rience givr√©e unique.',
            rating: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê', tag: 'üíé Puret√© Garantie', isFav: true,
            tiers: [{ w: '1.G', p: 60 }, { w: '2.G', p: 120 }, { w: '3.G', p: 160 }, { w: '5.G', p: 260 }, { w: '10.G', p: 400 }, { w: '50.G', p: 1500 }, { w: '100.G', p: 2800 }] 
        },
        { 
            id: 'PK', name: 'Pink Kush', category: 'Hash & Zaza Valley', icon: 'üß¨', 
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906290/06AECEF5-7C0A-493C-9588-99433B454A4E_2_1_hnlzee.mov', 
            desc: 'Import Cali üá∫üá∏. Taux THC 34%.', 
            rating: '‚≠ê‚≠ê‚≠ê‚≠ê', tag: 'üèÜ Top Shelf ‚Ä¢ THC+++', isFav: true,
            tiers: [{ w: '5.G', p: 60 }, { w: '10.G', p: 120 }, { w: '25.G', p: 220 }, { w: '50.G', p: 360 }, { w: '100.G', p: 640 }, { w: '500.G', p: 2200 }] 
        },
        { 
            id: 'SM', name: 'Simpsons Mousse', category: 'Hash & Zaza Valley', icon: 'üßΩ', 
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906298/IMG_1715_rtit70.mp4', 
            desc: 'La r√©f√©rence Mousseux 2025. Texture parfaite.',
            rating: '‚≠ê‚≠ê‚≠ê‚≠ê üßº', tag: 'Mousseux 2025', isFav: false,
            tiers: [{ w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 170 }, { w: '100.G', p: 350 }] 
        },
        { 
            id: 'XM', name: 'Xale Mousse', category: 'Hash & Zaza Valley', icon: 'üßΩ', 
            videoUrl: 'https://res.cloudinary.com/dlmmylat6/video/upload/v1764906313/IMG_1819_i4ipsf.mp4', 
            desc: 'Top jaune mousseux.',
            rating: '‚≠ê‚≠ê‚≠ê‚≠ê¬Ω üßº', tag: 'Top Jaune', isFav: false,
            tiers: [{ w: '10.G', p: 60 }, { w: '20.G', p: 100 }, { w: '50.G', p: 160 }, { w: '100.G', p: 330 }] 
        }
    ];

    const testimonials = [
        { name: "Client SVF‚Äô 01821", text: "Du caviar la Mont√©‚Äô CRISTO, pas s√®che, un r√©gal en soir√©e, merci la team ! üôèüèª" },
        { name: "Client SVF¬¥ 01544", text: "Op√©rationnel les frero, merci de nuit le service est rapide et la Cali c pour les gros poumons +1 ü´ÅüòÇ" },
        { name: "Client SVF‚Äô 01634", text: "Meet-up √† 15min de chez moi en transports, c‚Äôest du rapide et servie au gramme pr√®s merci SVF üëç" },
        { name: "Client SVF‚Äô 02983", text: "L√©g√®re attente mais je vais pas m‚Äôen plaindre √† 2h30, service au Top m√™me en soir de f√™te, je recommande üëèüèº" },
        { name: "Client SVF‚Äô 027187", text: "Rien √† dire, j‚Äôavais des doutes avant de commander mais c‚Äôest valid√©, j‚Äôte rappel √† l‚Äôoccas‚Äô ‚úåüèæ" }
    ];

    // --- NAVIGATION ---
    function changeScreen(screenName, category = null) {
        triggerHaptic();
        window.scrollTo(0,0);
        const main = document.getElementById('mainContent');
        main.innerHTML = ''; 
        main.className = "flex-1 px-4 py-6 w-full max-w-md mx-auto fade-in";

        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        if(screenName === 'menu') document.getElementById('nav-menu')?.classList.add('active');
        if(screenName === 'products') document.getElementById('nav-products')?.classList.add('active');
        if(screenName === 'contact') document.getElementById('nav-contact')?.classList.add('active');

        if(screenName === 'menu') main.innerHTML = renderMenu();
        else if(screenName === 'products') main.innerHTML = renderProducts(category);
        else if(screenName === 'cart') main.innerHTML = renderCart();
        else if(screenName === 'checkout') { securityCode = 'SV-' + Math.floor(10000+Math.random()*90000); main.innerHTML = renderCheckout(); fillCheckoutForm(); }
        else if(screenName === 'contact') main.innerHTML = renderContact();
        else if(screenName === 'success') main.innerHTML = renderSuccess();
        else main.innerHTML = renderMenu();

        updateCartCount();
        void main.offsetWidth; 
    }

    // --- VUES ---
    function renderMenu() {
        return `
            <div class="space-y-6 pt-2">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-white drop-shadow-md">Bienvenue au QG üéÑ</h2>
                    <p class="text-sm text-[--text-muted] mt-2 italic">L'√©quipe South Valley te souhaite un joyeux mois de D√©cembre !</p>
                </div>
                
                <div class="glass-card p-5 border-l-4 border-[--primary-accent] relative overflow-hidden">
                    <div class="absolute right-0 top-0 opacity-20 text-6xl transform translate-x-2 -translate-y-2">üéÅ</div>
                    <h3 class="text-xl font-bold text-[--primary-accent]">Offre de No√´l üéÖ</h3>
                    <p class="text-sm text-[--text-muted] mt-1">Invitez un ami, recevez un cadeau ! (Offre cumulable)</p>
                    <div class="mt-3 inline-block bg-[--primary-accent] text-black text-sm font-bold px-3 py-1 rounded-full">
                        1 Ami Valid√© = 1.G OFFERT üéÅ
                    </div>
                </div>

                <div class="grid gap-4">
                    <div onclick="changeScreen('products', 'Hash & Zaza Valley')" class="glass-card p-6 flex justify-between items-center cursor-pointer hover:bg-[--bg-card-highlight] transition-colors group">
                        <div><h3 class="text-xl font-bold text-[--primary-accent]">Hash & Zaza ü™¥</h3><p class="text-xs text-[--text-muted]">S√©lection premium - Coffee'Quality Certifi√©e !</p></div>
                        <span class="text-2xl">‚û°Ô∏è</span>
                    </div>
                    <div onclick="changeScreen('products', 'Snow Valley')" class="glass-card p-6 flex justify-between items-center cursor-pointer hover:bg-[--bg-card-highlight] transition-colors group">
                        <div><h3 class="text-xl font-bold text-white">Snow Valley ‚ùÑÔ∏è</h3><p class="text-xs text-[--text-muted]">Sp√©cial F√™tes ‚Ä¢ Givr√© üíé</p></div>
                        <span class="text-2xl">‚û°Ô∏è</span>
                    </div>
                </div>
                <div class="mt-8">
                    <h4 class="text-xl font-bold text-white mb-4">Retours Clients ‚≠ê</h4>
                    <div class="flex overflow-x-auto gap-4 pb-4 no-scrollbar">
                        ${testimonials.map(t => `<div class="glass-card p-4 min-w-[260px] border-l-2 border-[--primary-accent]"><p class="text-sm font-bold text-white">${t.name}</p><p class="text-xs text-[--text-muted] italic">"${t.text}"</p></div>`).join('')}
                    </div>
                </div>
            </div>`;
    }

    function renderProducts(cat) {
        const items = productData.filter(p => p.category === cat);
        return `
            <div class="space-y-4">
                <button onclick="changeScreen('menu')" class="text-[--text-muted] hover:text-white text-sm">‚¨ÖÔ∏è Retour</button>
                <h2 class="text-2xl font-bold text-white mb-4">${cat} üéÅ</h2>
                ${items.map(p => `
                    <div class="glass-card p-4 flex gap-4 ${p.isFav ? 'favorite' : ''}">
                        <div class="w-24 h-24 bg-black rounded-lg overflow-hidden flex-shrink-0 relative border border-[--border-subtle] cursor-pointer" onclick="openModal('${p.id}')">
                            <video src="${p.videoUrl}" class="w-full h-full object-cover opacity-80 pointer-events-none" muted loop playsinline autoplay></video>
                            <div class="absolute inset-0 flex items-center justify-center bg-black/20"><span class="text-2xl">‚ñ∂Ô∏è</span></div>
                            ${p.isFav ? '<div class="absolute top-0 right-0 bg-[--primary-accent] text-black text-[9px] font-bold px-1 rounded-bl">TOP üî•</div>' : ''}
                        </div>
                        <div class="flex-1 flex flex-col justify-between">
                            <div>
                                <h3 class="font-bold text-lg text-white">${p.name} ${p.icon}</h3>
                                <div class="text-[--primary-accent] text-xs font-bold mb-1">${p.rating}</div>
                                ${p.tag ? `<span class="text-[10px] bg-white/10 text-white px-2 py-0.5 rounded">${p.tag}</span>` : ''}
                            </div>
                            <button onclick="openModal('${p.id}')" class="btn-ghost text-xs py-2 px-4 mt-2 w-fit hover:bg-[--primary-accent] hover:text-white">Choisir ‚û°Ô∏è</button>
                        </div>
                    </div>
                `).join('')}
            </div>`;
    }

    function renderContact() {
        return `
            <div class="space-y-6 pt-2 pb-8">
                <h2 class="text-2xl font-bold text-white text-center mb-6">Services & Protocoles</h2>
                <div class="glass-card p-5">
                    <h3 class="text-lg font-bold text-[--primary-accent] mb-3 flex items-center gap-2"><span>ü§ù</span> MEET-UP South Valley</h3>
                    <div class="mini-map-container"><img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765072481/Sans_titre_Logo_2_oajwa3.png" class="mini-map-img"></div>
                    <p class="text-sm text-[--text-muted] mb-2">Nos meet-ups se d√©roulent dans le 92. Adresses discr√®tes et sans vis-√†-vis pour votre s√©curit√©. üòá</p>
                    <div class="flex items-center gap-2 mb-3 mt-3">
                        <span class="bg-blue-900/40 text-blue-300 text-xs font-bold px-2 py-1 rounded">Ligne 13</span>
                        <span class="bg-yellow-900/40 text-yellow-300 text-xs font-bold px-2 py-1 rounded">RER C</span>
                        <span class="bg-purple-900/40 text-purple-300 text-xs font-bold px-2 py-1 rounded">RER L</span>
                    </div>
                    <p class="text-sm font-bold text-white mb-4">üï∞Ô∏è Horaires : 10:30 √† 02:00</p>
                    <div class="bg-black/20 p-3 rounded-lg">
                        <h4 class="text-xs font-bold text-[--text-muted] uppercase mb-2">üìå Modalit√©s de commande</h4>
                        <ul class="list-none text-xs text-[--text-muted] space-y-2">
                            <li class="flex gap-2"><span class="text-white">üÜî</span> <span class="leading-tight">V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</span></li>
                            <li class="flex gap-2"><span class="text-white">üõç</span> <span class="leading-tight">Consulte le menu via notre Mini-app.</span></li>
                            <li class="flex gap-2"><span class="text-white">‚úçÔ∏è</span> <span class="leading-tight">Envoie ta commande compl√®te.</span></li>
                            <li class="flex gap-2"><span class="text-white">üí¨</span> <span class="leading-tight">On te communique l‚Äôadresse & l‚Äôitin√©raire.</span></li>
                            <li class="flex gap-2"><span class="text-white">üö∂‚Äç‚ôÇÔ∏è</span> <span class="leading-tight">Tu passes r√©cup√©rer ta commande.</span></li>
                        </ul>
                    </div>
                </div>
                <div class="glass-card p-5">
                    <h3 class="text-lg font-bold text-[--primary-accent] mb-3 flex items-center gap-2"><span>üì¶</span> Livraisons South Valley</h3>
                    <div class="mini-map-container"><img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765072290/Sans_titre_Logo_1_vtesoh.png" class="mini-map-img"></div>
                    <p class="text-sm text-[--text-muted] mb-4">Nous desservons toute l‚Äô√éle-de-France et certaines zones hors IDF.</p>
                    <div class="space-y-3 mb-4">
                        <div class="bg-black/20 p-3 rounded-lg border-l-2 border-blue-500"><p class="text-xs font-bold text-white">üá´üá∑ √éle-de-France compl√®te</p><p class="text-xs text-[--primary-accent] mt-1">Min. : 60‚Ç¨ ü§ù</p></div>
                        <div class="bg-black/20 p-3 rounded-lg border-l-2 border-purple-500"><p class="text-xs font-bold text-white">üìç R√©gions limitrophes</p><p class="text-[10px] text-[--text-muted]">(28/60/45/02/89/27/10)</p><p class="text-xs text-[--primary-accent] mt-1">Min. : 200‚Ç¨ ü§ù</p></div>
                    </div>
                    <div class="bg-black/20 p-3 rounded-lg">
                        <h4 class="text-xs font-bold text-[--text-muted] uppercase mb-2">üìå Modalit√©s de commande</h4>
                        <ul class="list-none text-xs text-[--text-muted] space-y-2">
                            <li class="flex gap-2"><span class="text-white">üÜî</span> <span class="leading-tight">V√©rification d‚Äôidentit√© obligatoire pour les nouveaux arrivants.</span></li>
                            <li class="flex gap-2"><span class="text-white">‚ö†Ô∏è</span> <span class="leading-tight">Prise de commande √† n'importe quel moment.</span></li>
                            <li class="flex gap-2"><span class="text-white">‚úçÔ∏è</span> <span class="leading-tight">Envoie ta demande compl√®te en remplissant les champs pr√©sent au Check-out.</span></li>
                            <li class="flex gap-2"><span class="text-white">üíµ</span> <span class="leading-tight">R√®glement en liquide uniquement.</span></li>
                            <li class="flex gap-2"><span class="text-white">üì¶</span> <span class="leading-tight">On se d√©place jusqu‚Äô√† l‚Äôadresse de ton choix pour garantir une livraison s√©curis√©e & en toute discr√©tion.</span></li>
                        </ul>
                    </div>
                </div>
                <div class="glass-card p-5 border border-[--primary-accent] relative overflow-hidden">
                    <div class="absolute right-[-10px] top-[-10px] bg-[--primary-accent] text-black text-[10px] font-bold px-3 py-1 rotate-12">PREMIUM</div>
                    <h3 class="text-lg font-bold text-[--primary-accent] mb-3 flex items-center gap-2"><span>üì¨</span> South Valley Postal Service</h3>
                    <div class="mini-map-container"><img src="https://res.cloudinary.com/dlmmylat6/image/upload/v1765072664/Sans_titre_Logo_3_y02vdt.png" class="mini-map-img"></div>
                    <p class="text-sm text-[--text-muted] mb-4">L'√©quipe South Valley vous garantit une exp√©rience exclusive gr√¢ce au service d'Envois Postal.</p>
                    <p class="text-xs text-white bg-black/40 p-2 rounded mb-4">S√©lectionnez vos produits, puis choisissez le paiement <b>Crypto (BTC/LTC/ETH/USDT)</b> ou <b>PCS</b> au checkout.</p>
                    <div class="space-y-3 text-xs text-[--text-muted]">
                        <p class="flex gap-2 items-start"><span class="text-xl">üì¶</span> <span><strong class="text-white">CONFIDENTIALIT√â MAXIMALE :</strong> LES COMMANDES SONT TRIPLEMENT SCELL√âES SOUS VIDE ET EMBALL√âES DANS UN EMBALLAGE EXTRA DISCRET POUR PLUS DE CONFIDENTIALIT√â.</span></p>
                        <p class="flex gap-2 items-start"><span class="text-xl">‚úÖ</span> <span><strong class="text-white">RAPIDIT√â :</strong> UNE FOIS LE PAIEMENT EFFECTU√â, VOTRE COMMANDE SERA EXP√âDI√âE LE JOUR OUVRABLE SUIVANT ET VOUS RECEVREZ UN NUM√âRO DE SUIVI.</span></p>
                        <p class="flex gap-2 items-start"><span class="text-xl">üõ°Ô∏è</span> <span><strong class="text-white">ASSURANCE 100% :</strong> NOUS OFFRONS √âGALEMENT UNE ASSURANCE √Ä 100 % SI LE COLIS N'ARRIVE PAS √Ä DESTINATION EN RAISON D'UNE ERREUR DE NOTRE PART (CE QUI EST RARE).</span></p>
                    </div>
                </div>
            </div>`;
    }

    function renderCart() {
        if (cart.length === 0) return `<div class="flex flex-col items-center justify-center h-[50vh]"><h3 class="text-xl font-bold text-white">Panier Vide üíî</h3><button onclick="changeScreen('menu')" class="btn-main px-6 py-3 mt-4">Explorer</button></div>`;
        const total = cart.reduce((acc, i) => acc + (i.price * i.quantity), 0);
        return `
            <div class="space-y-6">
                <h2 class="text-2xl font-bold text-white">üì¶ Votre Panier</h2>
                ${cart.map((item, idx) => `
                    <div class="glass-card p-4 flex justify-between items-center">
                        <div><p class="font-bold text-white">${item.name}</p><p class="text-xs text-[--text-muted]">${item.price}‚Ç¨ / u</p></div>
                        <div class="flex items-center gap-3 bg-black/30 rounded-lg p-1">
                            <button onclick="updateQty(${idx}, -1)" class="w-8 text-[--text-muted]">-</button>
                            <span class="text-sm font-bold w-4 text-center">${item.quantity}</span>
                            <button onclick="updateQty(${idx}, 1)" class="w-8 text-[--text-muted]">+</button>
                            <button onclick="removeItem(${idx})" class="text-xl text-[--danger] ml-2">üóëÔ∏è</button>
                        </div>
                    </div>`).join('')}
                <div class="glass-card p-5 mt-8">
                    <div class="flex justify-between items-center mb-6"><span class="text-[--text-muted]">Total</span><span class="text-2xl font-bold text-[--primary-accent]">${total}‚Ç¨</span></div>
                    <button onclick="changeScreen('checkout')" class="btn-main w-full py-4">VALIDER üîí</button>
                </div>
            </div>`;
    }

    function renderCheckout() {
        const total = cart.reduce((acc, i) => acc + (i.price * i.quantity), 0);
        return `
            <div class="space-y-6">
                <button onclick="changeScreen('cart')" class="text-sm text-[--text-muted] hover:text-white mb-2">‚Üê Retour</button>
                <h2 class="text-2xl font-bold text-white">Validation</h2>
                <div class="bg-red-500/10 border border-red-500/30 p-4 rounded-xl"><p class="text-xs text-red-200">‚ö†Ô∏è 1√®re commande ? CNI + Selfie obligatoire sur WhatsApp.</p></div>
                <form class="space-y-4">
                    <div><label class="text-xs text-[--text-muted] font-bold">Service</label>
                    <div class="grid gap-2 mt-1">
                        <button type="button" onclick="selectService(this, 'LIVRAISON')" class="service-opt glass-card p-3 text-sm text-[--text-muted] hover:text-white text-left">üöö Livraison</button>
                        <button type="button" onclick="selectService(this, 'MEET-UP')" class="service-opt glass-card p-3 text-sm text-[--text-muted] hover:text-white text-left">ü§ù Meet-up</button>
                        <button type="button" onclick="selectService(this, 'POSTAL')" class="service-opt glass-card p-3 text-sm text-[--text-muted] hover:text-white text-left">üì¨ Postal</button>
                    </div><input type="hidden" id="serviceType"></div>

                    <div><label class="text-xs text-[--text-muted] font-bold">Infos</label>
                    <input type="text" id="tgUser" placeholder="Pseudo Telegram" class="input-modern mt-1 mb-2">
                    <input type="text" id="shippingName" placeholder="Nom Complet (Obligatoire)" class="input-modern mt-1 mb-2">
                    <input type="text" id="waNum" placeholder="Num√©ro WhatsApp (Obligatoire)" class="input-modern mt-1 mb-2 border-l-4 border-l-[--primary-accent]">
                    <input type="text" id="address" placeholder="Adresse compl√®te" class="input-modern mt-1"></div>

                    <div><label class="text-xs text-[--text-muted] font-bold">Paiement</label>
                    <div class="grid grid-cols-2 gap-2 mt-1">
                        <button type="button" onclick="selectPayment(this, 'CASH')" class="payment-opt glass-card p-3 text-sm text-[--text-muted]">üíµ CASH</button>
                        <button type="button" onclick="selectPayment(this, 'CRYPTO')" class="payment-opt glass-card p-3 text-sm text-[--text-muted]">‚Çø CRYPTO</button>
                    </div><input type="hidden" id="paymentMethod"></div>
                </form>
                <div class="mt-8 pt-4 border-t border-[--border-subtle]">
                    <div class="flex justify-between mb-4"><span class="text-sm">TOTAL</span><span class="text-xl font-bold text-[--primary-accent]">${total}‚Ç¨</span></div>
                    <button onclick="submitOrder()" class="btn-main w-full py-4">ENVOYER LA COMMANDE üì©</button>
                </div>
            </div>`;
    }

    function renderSuccess() {
        return `
            <div class="flex flex-col items-center justify-center h-[60vh] text-center px-4">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mb-4"><span class="text-3xl">‚úÖ</span></div>
                <h2 class="text-3xl font-bold text-white mb-2">Envoy√© !</h2>
                <div class="glass-card p-4 w-full max-w-xs border-dashed border-2 border-[--border-subtle] mb-6">
                    <p class="text-xs text-[--text-muted]">Code Unique</p><p class="text-2xl font-mono font-bold text-[--primary-accent]">${securityCode}</p>
                </div>
                <a id="waBtn" href="#" target="_blank" class="btn-main px-8 py-3 w-full max-w-xs flex items-center justify-center gap-2"><span class="text-xl">üü¢</span> Ouvrir WhatsApp</a>
            </div>`;
    }

    // --- ACTIONS ---
    function openModal(id) {
        const p = productData.find(x => x.id === id);
        document.getElementById('modalTitle').textContent = p.name;
        document.getElementById('modalDesc').textContent = p.desc;
        const vid = document.getElementById('productVideo');
        vid.src = p.videoUrl; 
        vid.load();
        document.getElementById('tiersContainer').innerHTML = p.tiers.map(t => `
            <div class="flex justify-between items-center p-3 rounded-lg bg-black/30 border border-[--border-subtle]">
                <span class="font-bold text-white">${t.w}</span>
                <div class="flex items-center gap-3">
                    <span class="text-[--primary-accent] font-bold">${t.p}‚Ç¨</span>
                    <button onclick="addToCart('${p.id}', '${p.name}', '${t.w}', ${t.p})" class="bg-white text-black text-xs font-bold px-3 py-1.5 rounded hover:bg-gray-200">+</button>
                </div>
            </div>`).join('');
        document.getElementById('productModal').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('productModal').classList.add('hidden');
        document.getElementById('productVideo').pause();
    }

    function addToCart(id, name, w, p) {
        triggerHaptic();
        const item = cart.find(x => x.id === id && x.w === w);
        if(item) item.quantity++; else cart.push({id, name: `${name} (${w})`, price: p, quantity: 1, w});
        closeModal(); updateCartCount();
    }

    function updateQty(idx, d) {
        if (cart[idx].quantity + d <= 0) cart.splice(idx, 1); else cart[idx].quantity += d;
        changeScreen('cart');
    }
    
    function removeItem(idx) { cart.splice(idx, 1); changeScreen('cart'); }
    function updateCartCount() { document.getElementById('cartCount').textContent = cart.reduce((a,b)=>a+b.quantity,0); }

    function selectService(btn, type) {
        document.querySelectorAll('.service-opt').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); document.getElementById('serviceType').value = type;
    }
    function selectPayment(btn, type) {
        document.querySelectorAll('.payment-opt').forEach(b => b.classList.remove('active'));
        btn.classList.add('active'); document.getElementById('paymentMethod').value = type;
    }

    // --- AUTO-FILL ---
    function fillCheckoutForm() {
        if(localStorage.getItem('sv_name')) document.getElementById('shippingName').value = localStorage.getItem('sv_name');
        if(localStorage.getItem('sv_address')) document.getElementById('address').value = localStorage.getItem('sv_address');
        if(localStorage.getItem('sv_phone')) document.getElementById('waNum').value = localStorage.getItem('sv_phone');
        if(localStorage.getItem('sv_tg')) document.getElementById('tgUser').value = localStorage.getItem('sv_tg');
    }

    function submitOrder() {
        triggerHaptic();
        const s = document.getElementById('serviceType').value;
        const wa = document.getElementById('waNum').value;
        const addr = document.getElementById('address').value;
        const pay = document.getElementById('paymentMethod').value;
        const tg = document.getElementById('tgUser').value;
        const name = document.getElementById('shippingName').value;

        if(!s || !wa || !addr || !pay || !name) return alert("Veuillez remplir Service, Nom, WhatsApp, Adresse et Paiement.");
        
        // SAVE INFO
        localStorage.setItem('sv_name', name);
        localStorage.setItem('sv_address', addr);
        localStorage.setItem('sv_phone', wa);
        localStorage.setItem('sv_tg', tg);

        if(!securityCode) securityCode = 'SV-' + Math.floor(10000+Math.random()*90000);
        const total = cart.reduce((a,i)=>a+(i.price*i.quantity),0);
        const items = cart.map(i=>`‚ñ´Ô∏è ${i.quantity}x ${i.name}`).join('\n');
        const msg = `*NOUVELLE COMMANDE* üèúÔ∏è\nCode: ${securityCode}\nTG: ${tg}\nNom: ${name}\nWA: ${wa}\n\nüõí:\n${items}\n\nüí∞ *${total}‚Ç¨*\nüìç ${s}\nüè† ${addr}\nüí≥ ${pay}`;
        
        const link = `https://wa.me/33759840764?text=${encodeURIComponent(msg)}`;
        changeScreen('success');
        setTimeout(() => { document.getElementById('waBtn').href = link; window.open(link, '_blank'); }, 100);
    }

    // --- INIT NEIGE ---
    function initSnow() {
        const container = document.getElementById('snow-container');
        for (let i = 0; i < 40; i++) {
            const flake = document.createElement('div');
            flake.classList.add('snowflake');
            flake.textContent = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚Ä¢'][Math.floor(Math.random() * 4)];
            flake.style.left = Math.random() * 100 + 'vw';
            flake.style.animationDuration = Math.random() * 5 + 5 + 's';
            flake.style.opacity = Math.random() * 0.5 + 0.2;
            flake.style.fontSize = Math.random() * 10 + 8 + 'px';
            flake.style.animationDelay = Math.random() * 5 + 's';
            container.appendChild(flake);
        }
    }

    function triggerHaptic() {
        if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) {
            window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
        }
    }

    window.onload = () => {
        initSnow();
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('opacity-0', 'pointer-events-none');
            document.getElementById('appContainer').classList.remove('hidden');
            changeScreen('menu');
        }, 1500);
    }
</script>
</body>
</html>
